---
import BaseLayout from '../layouts/BaseLayout.astro';
import { Icon } from 'astro-icon/components';
import { getCollection } from 'astro:content';
import Breadcrumbs from '../components/Breadcrumbs.astro';

// Fetch recent blog posts for the resources section
const allBlogPosts = await getCollection('blog');
const recentBlogPosts = allBlogPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

// SEO Metadata
const title = "NDIS Provider Sydney & Melbourne | MD Home Care";
const description = "Find trusted NDIS providers in Sydney & Melbourne through MD Home Care. Connect with vetted professionals for 24/7 home care, SIL accommodation, and support coordination.";

// Data for sections
const features = [
  {
    icon: "hugeicons:shield-01",
    badge: "Trusted Network",
    title: "Vetted Professionals You Can Trust",
    desc: "Finding the right support worker can feel overwhelming. MD Home Care connects you with fully background-checked, qualified professionals who are carefully vetted before joining the network.",
    desc2: "Browse provider profiles, read reviews from other participants, and connect with support workers who understand your needs and preferences.",
    img: "/assets/nurse.webp"
  },
  {
    icon: "hugeicons:clock-01",
    badge: "Always Available",
    title: "24/7 Support Providers",
    desc: "Life doesn't follow a 9-to-5 schedule. Find providers on MD Home Care who offer round-the-clock support, whether it's early morning routines, overnight care, or assistance during weekends and holidays.",
    desc2: "For participants with complex needs, 24/7 support isn't a luxury, it's essential. Connect with providers who offer seamless care coordination through the MD Home Care network.",
    img: "/assets/grandma.webp"
  },
  {
    icon: "hugeicons:favourite",
    badge: "Clinical Excellence",
    title: "Nurse-Led Care Providers",
    desc: "Complex care requires expert oversight. Find experienced Registered Nurses through MD Home Care who develop comprehensive care plans, provide clinical governance, and maintain best-practice standards.",
    desc2: "From wound care and medication management to high-intensity daily personal activities, connect with providers who bring hospital-grade expertise into the comfort of your home.",
    img: "/assets/clinic.webp"
  },
  {
    icon: "hugeicons:global",
    badge: "Diverse Community",
    title: "Culturally Diverse Provider Network",
    desc: "Great care starts with understanding. The MD Home Care network includes providers from diverse cultural backgrounds who speak over 20 languages, ensuring authentic and respectful connections.",
    desc2: "Whether it's preparing culturally appropriate meals, respecting religious practices, or simply communicating in your preferred language, find providers who adapt their care to fit your life.",
    img: "/assets/elderlyaboriginal.webp"
  }
];

const services = [
  {
    badge: "Daily Living",
    title: "In-Home Support",
    desc: "Your home should be a place of comfort and independence. Find in-home support providers through MD Home Care who help you maintain your daily routines with dignity, from personal care and hygiene assistance to meal preparation and household tasks.",
    desc2: "Connect with providers who work with you to create a support plan that fits seamlessly into your life, ensuring you have the help you need without losing the independence you value.",
    icon: "hugeicons:home-03",
    link: "/services/disability-home-support-services",
    img: "/assets/homecare.webp"
  },
  {
    badge: "Accommodation",
    title: "SIL & Specialist Housing",
    desc: "For those who need more comprehensive support, find Supported Independent Living (SIL) providers offering 24/7 care in purpose-built or modified homes. MD Home Care also connects you with Specialist Disability Accommodation (SDA) options.",
    desc2: "Browse SIL providers whose homes are designed to foster independence while ensuring safety. Live alongside others with similar support needs, building community and friendships along the way.",
    icon: "hugeicons:building-03",
    link: "/services/sil-services",
    img: "/assets/accessible-bathroom.webp"
  },
  {
    badge: "Social & Recreation",
    title: "Community Access",
    desc: "Life is richer when you're connected to your community. Find community access providers through MD Home Care who help you participate in social activities, pursue hobbies, access local services, and build meaningful relationships outside the home.",
    desc2: "Whether it's joining a local sports club, attending community events, or simply getting out for coffee with friends, connect with providers who offer the transport and support to make it happen.",
    icon: "hugeicons:user-group",
    link: "/services/community-access-support",
    img: "/assets/wheelchair.webp"
  },
  {
    badge: "Plan Navigation",
    title: "Support Coordination",
    desc: "The NDIS can be complex to navigate. Find specialist support coordinators through MD Home Care who help you understand your plan, connect with the right providers, and ensure you're getting the most out of your funding.",
    desc2: "Connect with coordinators who act as your advocate, helping you build capacity to manage your own supports over time while ensuring nothing falls through the cracks.",
    icon: "hugeicons:file-01",
    link: "/services/ndis-specialist-support-coordination",
    img: "/assets/carer.webp"
  }
];

const stats = [
  { label: "Families Supported", value: "500+" },
  { label: "Years Experience", value: "10+" },
  { label: "Suburbs Served", value: "150+" },
  { label: "Satisfaction Rate", value: "98%" },
];

// WebSite schema for sitelinks searchbox
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "MD Home Care",
  "url": "https://mdhomecare.com.au",
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "https://mdhomecare.com.au/search?q={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  }
};
---

<BaseLayout {title} {description}>
  <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />

  <!-- Hero Section -->
  <section
    class="relative min-h-screen flex items-start lg:items-center bg-cover bg-center bg-no-repeat bg-fixed pt-32 sm:pt-36 lg:pt-0"
    style="background-image: url('/assets/grandmawhite.webp');"
  >
    <!-- Subtle Overlay for Readability -->
    <div class="absolute inset-0 bg-white/70 z-0"></div>

    <div class="relative z-10 px-4 sm:px-6 lg:px-8 lg:pl-[calc((100vw-72rem)/2+2rem)]">

      <h1 class="text-5xl lg:text-6xl font-bold text-secondary leading-[1.1] mb-6 tracking-tight text-balance max-w-2xl">
        Live Independently, <br class="hidden lg:block" />
        <span class="text-primary">Supported by Care.</span>
      </h1>

      <p class="text-xl text-secondary/70 font-medium mb-10 leading-relaxed text-balance max-w-xl">
        Connect with trusted NDIS providers in Sydney & Melbourne. Find compassionate in-home care, SIL accommodation, and specialist support designed around <em>your</em> life.
      </p>

      <div class="flex flex-col sm:flex-row items-start gap-4">
        <a href="/contact" class="btn btn-primary btn-lg px-10 rounded-full border-none hover:-translate-y-0.5 transition-transform duration-300">
          Get Started
        </a>
        <a href="tel:+61863869999" class="btn btn-lg px-8 rounded-full bg-white border border-base-200 text-secondary hover:bg-base-200 hover:border-primary/20 transition-all duration-300">
          <Icon name="hugeicons:call-02" class="h-5 w-5" />
          08 6386 9999
        </a>
      </div>

    </div>
  </section>

  <!-- Statistics Strip -->
  <section class="border-y border-base-200 bg-base-200/50">
    <div class="container-custom py-16">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
        {stats.map(stat => (
          <div class="text-center">
            <p class="text-4xl lg:text-5xl font-bold text-primary mb-2 tracking-tighter">{stat.value}</p>
            <p class="text-sm text-secondary/60 font-semibold uppercase tracking-widest">{stat.label}</p>
          </div>
        ))}
      </div>
          </div>
  </section>

  <!-- Services Section -->
  <section class="py-32 bg-base-100">
    <div class="container-custom">
      <div class="text-center max-w-3xl mx-auto mb-20">
        <h2 class="text-sm font-bold text-primary tracking-widest uppercase mb-4">Browse Services</h2>
        <h3 class="text-4xl lg:text-5xl font-bold text-secondary mb-6 tracking-tight">Comprehensive Support for Every Stage</h3>
        <p class="text-lg text-secondary/60 leading-relaxed">
          Whether you need daily assistance at home, specialized accommodation, or community access, find providers through MD Home Care who can help you achieve your goals.
        </p>
      </div>

      <div class="space-y-24 lg:space-y-32">
        {services.map((service, i) => (
          <div class={`flex flex-col ${i % 2 === 0 ? 'lg:flex-row' : 'lg:flex-row-reverse'} items-center gap-12 lg:gap-20`}>
            <div class="lg:w-1/2 relative">
              <div class={`absolute inset-0 rounded-[3rem] transform scale-105 z-0 ${i % 2 === 0 ? 'bg-primary/10 rotate-3' : 'bg-secondary/5 -rotate-3'}`}></div>
              <img src={service.img} alt={service.title} class="relative z-10 rounded-[3rem] shadow-2xl w-full h-auto object-cover aspect-[4/3]" />
            </div>
            <div class="lg:w-1/2">
              <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 text-primary text-xs font-bold uppercase tracking-wide mb-6">
                {service.badge}
              </div>
              <h3 class="text-3xl lg:text-4xl font-bold text-secondary mb-6 leading-tight tracking-tight">{service.title}</h3>
              <p class="text-lg text-secondary/60 mb-6 leading-relaxed">{service.desc}</p>
              <p class="text-lg text-secondary/60 mb-8 leading-relaxed">{service.desc2}</p>
              <a href={service.link} class="inline-flex items-center gap-2 text-primary font-semibold hover:gap-3 transition-all">
                Learn more about {service.title.toLowerCase()}
                <Icon name="hugeicons:arrow-right-01" class="h-5 w-5" />
              </a>
            </div>
          </div>
        ))}
      </div>

      <div class="text-center mt-20">
        <a href="/services" class="btn btn-primary rounded-full px-8">View All Services</a>
      </div>
    </div>
  </section>

  <!-- Suburb Search Section -->
  <section class="py-32 bg-secondary text-secondary-content relative overflow-hidden">
    <!-- Background Elements -->
    <div class="absolute inset-0 opacity-20 pointer-events-none">
      <div class="absolute right-0 top-0 w-2/3 h-full bg-gradient-to-l from-primary/20 to-transparent"></div>
    </div>

    <div class="container-custom relative z-10">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-4xl lg:text-5xl font-bold mb-8 tracking-tight">Find Support in Your Area</h2>
        <p class="text-lg text-secondary-content/70 mb-12">
          Browse providers across Sydney and Melbourne. Enter your suburb to see what's available near you.
        </p>
        
        <div class="relative max-w-xl mx-auto">
          <div class="flex items-center justify-center relative group">
            <div class="absolute left-6 text-base-content/40 z-10">
              <Icon name="hugeicons:search-01" class="h-6 w-6" />
            </div>
            <input
              type="text"
              id="suburb-search"
              placeholder="Search by suburb (e.g. Parramatta, Richmond)..."
              class="input input-lg w-full h-16 pl-14 pr-6 rounded-full bg-base-100 text-base-content focus:outline-none border-2 border-transparent focus:border-primary/50 transition-all duration-300"
            />
          </div>
          <!-- Dropdown Results -->
          <div id="suburb-suggestions" class="hidden absolute left-0 right-0 top-full mt-4 bg-base-100 text-base-content rounded-[1.5rem] shadow-2xl max-h-72 overflow-y-auto z-50 text-left border border-base-200/50 p-2"></div>

          <!-- Service Results Accordion (shown after suburb selection) -->
          <div id="service-results" class="hidden mt-8">
            <div class="bg-base-100 rounded-[1.5rem] border border-base-200/50 overflow-hidden">
              <button id="accordion-toggle" class="w-full flex items-center justify-between p-6 text-left hover:bg-base-200/50 transition-colors">
                <div>
                  <h4 id="accordion-title" class="text-xl font-bold text-secondary">Services in Your Area</h4>
                  <p class="text-sm text-secondary/60 mt-1">Click to view available services</p>
                </div>
                <Icon name="hugeicons:arrow-down-01" id="accordion-icon" class="h-6 w-6 text-primary transition-transform duration-300" />
              </button>
              <div id="accordion-content" class="px-6 pb-6">
                <ul id="service-list" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Why Choose Us -->
  <section class="py-32 bg-base-200/30">
    <div class="container-custom">
      <div class="text-center max-w-3xl mx-auto mb-20">
        <h2 class="text-sm font-bold text-primary tracking-widest uppercase mb-4">Why MD Home Care?</h2>
        <h3 class="text-4xl lg:text-5xl font-bold text-secondary mb-6 tracking-tight">Care That Feels Like Family.</h3>
        <p class="text-lg text-secondary/60 leading-relaxed">
          MD Home Care helps you find providers who build real relationships, not just deliver services. Browse profiles of professionals centered on respect, dignity, and understanding the unique story of every individual they support.
        </p>
      </div>

      <div class="space-y-24 lg:space-y-32">
        {features.map((feature, i) => (
          <div class={`flex flex-col ${i % 2 === 0 ? 'lg:flex-row' : 'lg:flex-row-reverse'} items-center gap-12 lg:gap-20`}>
            <div class="lg:w-1/2 relative">
              <div class={`absolute inset-0 rounded-[3rem] transform scale-105 z-0 ${i % 2 === 0 ? 'bg-primary/10 rotate-3' : 'bg-secondary/5 -rotate-3'}`}></div>
              <img src={feature.img} alt={feature.title} class="relative z-10 rounded-[3rem] shadow-2xl w-full h-auto object-cover aspect-[4/3]" />
            </div>
            <div class="lg:w-1/2">
              <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 text-primary text-xs font-bold uppercase tracking-wide mb-6">
                {feature.badge}
              </div>
              <h3 class="text-3xl lg:text-4xl font-bold text-secondary mb-6 leading-tight tracking-tight">{feature.title}</h3>
              <p class="text-lg text-secondary/60 mb-6 leading-relaxed">{feature.desc}</p>
              <p class="text-lg text-secondary/60 leading-relaxed">{feature.desc2}</p>
            </div>
          </div>
        ))}
      </div>

      <div class="text-center mt-20">
        <a href="/about" class="btn btn-primary rounded-full px-8">About MD Home Care</a>
      </div>
    </div>
  </section>

  <!-- Testimonials -->
  <section class="py-32 bg-base-100">
    <div class="container-custom text-center">
      <h2 class="text-4xl lg:text-5xl font-bold text-secondary mb-20 tracking-tight">Stories from Our Community</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- Review 1 -->
        <div class="bg-base-200 rounded-[2rem] p-10 text-left relative group hover:bg-white border border-transparent hover:border-base-200 transition-all duration-500">
          <div class="text-warning text-lg mb-6 flex gap-1">
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
          </div>
          <p class="text-secondary/70 italic mb-8 leading-loose text-lg">
            "The peace of mind I have knowing my mother is being cared for by such genuine, skilled people is priceless. Finding them through MD Home Care made all the difference."
          </p>
              <div>
            <p class="font-bold text-secondary">Sarah Jenkins</p>
            <p class="text-xs text-secondary/40 uppercase tracking-wider font-semibold mt-1">Sydney, NSW</p>
          </div>
        </div>

        <!-- Review 2 -->
        <div class="bg-base-200 rounded-[2rem] p-10 text-left relative group hover:bg-white border border-transparent hover:border-base-200 transition-all duration-500">
          <div class="text-warning text-lg mb-6 flex gap-1">
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
              </div>
          <p class="text-secondary/70 italic mb-8 leading-loose text-lg">
            "We struggled to find a provider who understood complex care needs until we used MD Home Care. The nurses in their network are exceptional."
          </p>
              <div>
            <p class="font-bold text-secondary">Michael Ross</p>
            <p class="text-xs text-secondary/40 uppercase tracking-wider font-semibold mt-1">Melbourne, VIC</p>
          </div>
        </div>

        <!-- Review 3 -->
        <div class="bg-base-200 rounded-[2rem] p-10 text-left relative group hover:bg-white border border-transparent hover:border-base-200 transition-all duration-500">
          <div class="text-warning text-lg mb-6 flex gap-1">
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
              </div>
          <p class="text-secondary/70 italic mb-8 leading-loose text-lg">
            "Consistent, reliable, and friendly. The support workers I found through MD Home Care actually engage with my son and have helped him build confidence."
          </p>
              <div>
            <p class="font-bold text-secondary">Amanda Lee</p>
            <p class="text-xs text-secondary/40 uppercase tracking-wider font-semibold mt-1">Parramatta, NSW</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-32 bg-primary text-primary-content relative overflow-hidden">
    <!-- Decorative circles -->
    <div class="absolute top-0 right-0 -translate-y-1/2 translate-x-1/3 w-[500px] h-[500px] bg-white/5 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 left-0 translate-y-1/2 -translate-x-1/3 w-[500px] h-[500px] bg-white/5 rounded-full blur-3xl"></div>

    <div class="container-custom relative z-10 text-center">
      <h2 class="text-4xl lg:text-6xl font-bold mb-8 tracking-tight">Ready to Start Your Journey?</h2>
      <p class="text-xl text-primary-content/80 mb-12 max-w-2xl mx-auto leading-relaxed">
        Get help finding the right NDIS providers for your plan or home care needs. MD Home Care is here to connect you with trusted professionals.
      </p>
      <div class="flex flex-col sm:flex-row gap-6 justify-center">
        <a href="/contact" class="btn btn-lg bg-white text-primary hover:bg-base-100 border-none shadow-none rounded-full px-10">
          Contact Us Today
        </a>
        <a href="tel:+61863869999" class="btn btn-lg btn-outline text-white border-white/30 hover:bg-white/10 hover:border-white rounded-full px-10">
          <Icon name="hugeicons:call-02" class="h-5 w-5" />
          Call 08 6386 9999
        </a>
      </div>
    </div>
  </section>

  <!-- Resources/Blog Section -->
  <section class="py-32 bg-base-100">
    <div class="container-custom">
      <div class="flex flex-col sm:flex-row justify-between items-end mb-16 gap-4">
        <div>
          <h2 class="text-sm font-bold text-primary tracking-widest uppercase mb-4">Resources</h2>
          <h3 class="text-4xl font-bold text-secondary tracking-tight">Latest News & Guides</h3>
        </div>
        <a href="/blog" class="link link-hover text-primary font-semibold flex items-center gap-2 hover:gap-3 transition-all">
          View all articles
          <Icon name="hugeicons:arrow-right-01" class="h-4 w-4" />
        </a>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
        {recentBlogPosts.map((post, i) => (
          <a href={`/blog/${post.slug}`} class="group">
            <div class="relative mb-6">
              <div class={`absolute inset-0 rounded-[2rem] transform scale-105 z-0 ${i % 2 === 0 ? 'bg-primary/10 rotate-2' : 'bg-secondary/5 -rotate-2'}`}></div>
              <img
                src={post.data.image || '/assets/homecare.webp'}
                alt={post.data.title}
                class="relative z-10 rounded-[2rem] shadow-xl w-full h-auto object-cover aspect-[16/10]"
              />
            </div>
            <p class="text-primary text-xs mb-2 font-bold uppercase tracking-wider">
              {new Date(post.data.pubDate).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
            </p>
            <h4 class="text-xl font-bold text-secondary mb-3 group-hover:text-primary transition-colors line-clamp-2 tracking-tight">
              {post.data.title}
            </h4>
            <p class="text-secondary/60 line-clamp-2 text-sm leading-relaxed">
              {post.data.description}
            </p>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Service Modal (Kept for functionality) -->
  <dialog id="service-modal" class="modal">
    <div class="modal-box max-w-3xl rounded-2xl p-0 overflow-hidden">
      <div class="bg-secondary p-6 flex justify-between items-center text-white">
        <h3 class="font-bold text-xl" id="modal-title">Available Services</h3>
      <form method="dialog">
          <button class="btn btn-sm btn-circle btn-ghost text-white/70 hover:text-white">
          <Icon name="hugeicons:cancel-01" class="h-5 w-5" />
        </button>
      </form>
      </div>
      <div class="p-6 max-h-[70vh] overflow-y-auto">
      <ul id="modal-service-list" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></ul>
      </div>
    </div>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>

</BaseLayout>

<script>
  // Suburb Search Functionality
  const services = [
    { name: "Accommodation Support", slug: "accommodation-support" },
    { name: "Aged Care Advocacy", slug: "aged-care-advocacy" },
    { name: "Home Modifications", slug: "aged-care-home-modifications-maintenance" },
    { name: "Allied Health", slug: "allied-health-disciplines" },
    { name: "Assistive Technology", slug: "assistive-technology-assessment" },
    { name: "Behaviour Support", slug: "behaviour-support" },
    { name: "Clinical Care", slug: "clinical-care" },
    { name: "Community Access", slug: "community-access-support" },
    { name: "Community Nursing", slug: "community-nursing-care" },
    { name: "Companionship Services", slug: "companionship-services" },
    { name: "Complex Care", slug: "complex-care" },
    { name: "Continence Care", slug: "continence-care-home" },
    { name: "Domestic Assistance", slug: "domestic-assistance" },
    { name: "Home Care Packages", slug: "home-care-packages" },
    { name: "Life Skills Development", slug: "life-skills-development" },
    { name: "Meal Preparation", slug: "meal-preparation-support" },
    { name: "Occupational Therapy", slug: "occupational-therapy-home" },
    { name: "Personal Care", slug: "personal-care" },
    { name: "Physiotherapy", slug: "physiotherapy-home-care" },
    { name: "Plan Management", slug: "plan-management" },
    { name: "Psychosocial Recovery Coaching", slug: "psychosocial-recovery-coaching" },
    { name: "Respite Care", slug: "respite-care" },
    { name: "SIL Services", slug: "sil-services" },
    { name: "Specialist Coordination", slug: "ndis-specialist-support-coordination" },
    { name: "Specialist Disability Accommodation", slug: "specialist-disability-accommodation" },
    { name: "Support Workers", slug: "support-workers" },
    { name: "Transport Services", slug: "transport-services" }
  ];

  const searchInput = document.getElementById('suburb-search') as HTMLInputElement;
  const suggestionsPanel = document.getElementById('suburb-suggestions') as HTMLDivElement;
  const modal = document.getElementById('service-modal') as HTMLDialogElement;
  const modalTitle = document.getElementById('modal-title') as HTMLHeadingElement;
  const modalServiceList = document.getElementById('modal-service-list') as HTMLUListElement;

  let suburbs: { [key: string]: { state: string; region: string } } = {};

  async function fetchSuburbs() {
    try {
      const response = await fetch('/data/australian-suburbs.json');
      if (!response.ok) throw new Error('Network response was not ok');
      suburbs = await response.json();
    } catch (error) {
      console.error('Failed to fetch suburbs:', error);
    }
  }

  function displaySuggestions(input: string) {
    const suburbKeys = Object.keys(suburbs);
    const filteredSuburbs = suburbKeys.filter(suburb => suburb.toLowerCase().startsWith(input)).slice(0, 10);
    suggestionsPanel.innerHTML = '';

    if (filteredSuburbs.length > 0) {
      filteredSuburbs.forEach(suburb => {
        const div = document.createElement('div');
        const state = suburbs[suburb].state;
        const displayName = toTitleCase(suburb.replace(/-/g, ' '));
        
        div.innerHTML = `
          <div class="px-4 py-3 cursor-pointer hover:bg-base-200 transition-colors border-b border-base-200 last:border-none">
            <p class="font-medium text-secondary">${displayName}</p>
            <p class="text-xs text-base-content/50 uppercase">${state}</p>
          </div>
        `;
        
        div.onclick = () => {
          showServicesForSuburb(suburb);
        };
        suggestionsPanel.appendChild(div);
      });
      suggestionsPanel.classList.remove('hidden');
    } else {
      suggestionsPanel.classList.add('hidden');
    }
  }

  function toTitleCase(str: string) {
    return str.replace(/\w\S*/g, (txt: string) => txt.charAt(0).toUpperCase() + txt.slice(1).toLowerCase());
  }

  function showServicesForSuburb(suburbKey: string) {
    const displayName = toTitleCase(suburbKey.replace(/-/g, ' '));
    modalTitle.textContent = `Services in ${displayName}`;
    modalServiceList.innerHTML = '';

    services.forEach(service => {
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = `/services/${service.slug}/${suburbKey}`;
      a.textContent = service.name;
      a.className = 'block p-3 bg-base-100 border border-base-200 rounded-lg hover:border-primary hover:text-primary hover:shadow-sm font-medium transition-all text-sm text-center sm:text-left';
      li.appendChild(a);
      modalServiceList.appendChild(li);
    });

    modal.showModal();
    suggestionsPanel.classList.add('hidden');
    searchInput.value = '';
  }

  if (searchInput) {
  searchInput.addEventListener('input', () => {
    const input = searchInput.value.toLowerCase();
    if (input.length > 1) {
      displaySuggestions(input);
    } else {
      suggestionsPanel.classList.add('hidden');
    }
  });

  document.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
      if (suggestionsPanel && !suggestionsPanel.contains(target) && target !== searchInput) {
      suggestionsPanel.classList.add('hidden');
    }
  });
  }

  fetchSuburbs();
</script>
