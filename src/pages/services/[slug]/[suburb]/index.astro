---
import { getCollection } from 'astro:content';
import BaseLayout from '../../../../layouts/BaseLayout.astro';
import { Icon } from 'astro-icon/components';
import EligibilityChecker from '../../../../components/EligibilityChecker.astro';
import QuickFacts from '../../../../components/QuickFacts.astro';
import SuburbTestimonials from '../../../../components/SuburbTestimonials.astro';
import regionContent from '../../../../data/region-content.json';
import suburbDetails from '../../../../data/suburb-details.json';
import { getNearbySuburbs, getRelatedBlogPosts, getCleanServiceName } from '../../../../utils/internalLinks';

// Type definitions
interface SuburbInfo {
  state: string;
  region: string;
}

interface SuburbData {
  [key: string]: SuburbInfo;
}

interface RegionContentData {
  [key: string]: {
    localInsight: string;
    nearbyHospitals: string[];
    transportNote: string;
    ndisOffice?: string;
    populationNote?: string;
  };
}

interface SuburbDetailsData {
  [key: string]: {
    displayName?: string;
    population?: string;
    elderlyPercent?: string;
    ndisParticipants?: string;
    localCouncil?: string;
    nearestHospital?: string;
    postcode?: string;
  };
}

// Generate static paths for all service/suburb combinations
export async function getStaticPaths() {
  // Hardcoded suburbs data
  const suburbsData: SuburbData = {
    // Greater Sydney
    "sydney": { "state": "NSW", "region": "Greater Sydney" },
    "cbd": { "state": "NSW", "region": "Greater Sydney" },
    "haymarket": { "state": "NSW", "region": "Greater Sydney" },
    "the-rocks": { "state": "NSW", "region": "Greater Sydney" },
    "barangaroo": { "state": "NSW", "region": "Greater Sydney" },
    "pyrmont": { "state": "NSW", "region": "Greater Sydney" },
    "ultimo": { "state": "NSW", "region": "Greater Sydney" },
    "chippendale": { "state": "NSW", "region": "Greater Sydney" },
    "surry-hills": { "state": "NSW", "region": "Greater Sydney" },
    "darlinghurst": { "state": "NSW", "region": "Greater Sydney" },
    "potts-point": { "state": "NSW", "region": "Greater Sydney" },
    "elizabeth-bay": { "state": "NSW", "region": "Greater Sydney" },
    "rushcutters-bay": { "state": "NSW", "region": "Greater Sydney" },
    "woolloomooloo": { "state": "NSW", "region": "Greater Sydney" },
    "redfern": { "state": "NSW", "region": "Greater Sydney" },
    "waterloo": { "state": "NSW", "region": "Greater Sydney" },
    "zetland": { "state": "NSW", "region": "Greater Sydney" },
    "alexandria": { "state": "NSW", "region": "Greater Sydney" },
    "erskineville": { "state": "NSW", "region": "Greater Sydney" },

    // Eastern Suburbs
    "bondi": { "state": "NSW", "region": "Eastern Suburbs" },
    "bondi-beach": { "state": "NSW", "region": "Eastern Suburbs" },
    "bondi-junction": { "state": "NSW", "region": "Eastern Suburbs" },
    "bronte": { "state": "NSW", "region": "Eastern Suburbs" },
    "clovelly": { "state": "NSW", "region": "Eastern Suburbs" },
    "coogee": { "state": "NSW", "region": "Eastern Suburbs" },
    "maroubra": { "state": "NSW", "region": "Eastern Suburbs" },
    "kensington": { "state": "NSW", "region": "Eastern Suburbs" },
    "randwick": { "state": "NSW", "region": "Eastern Suburbs" },
    "vaucluse": { "state": "NSW", "region": "Eastern Suburbs" },
    "rose-bay": { "state": "NSW", "region": "Eastern Suburbs" },
    "double-bay": { "state": "NSW", "region": "Eastern Suburbs" },
    "bellevue-hill": { "state": "NSW", "region": "Eastern Suburbs" },
    "dover-heights": { "state": "NSW", "region": "Eastern Suburbs" },
    "queens-park": { "state": "NSW", "region": "Eastern Suburbs" },
    "pagewood": { "state": "NSW", "region": "Eastern Suburbs" },
    "eastgardens": { "state": "NSW", "region": "Eastern Suburbs" },
    "little-bay": { "state": "NSW", "region": "Eastern Suburbs" },
    "la-perouse": { "state": "NSW", "region": "Eastern Suburbs" },

    // Inner West
    "burwood": { "state": "NSW", "region": "Inner West" },
    "strathfield": { "state": "NSW", "region": "Inner West" },
    "newtown": { "state": "NSW", "region": "Inner West" },
    "marrickville": { "state": "NSW", "region": "Inner West" },
    "dulwich-hill": { "state": "NSW", "region": "Inner West" },
    "summer-hill": { "state": "NSW", "region": "Inner West" },
    "ashfield": { "state": "NSW", "region": "Inner West" },
    "leichhardt": { "state": "NSW", "region": "Inner West" },
    "balmain": { "state": "NSW", "region": "Inner West" },
    "rozelle": { "state": "NSW", "region": "Inner West" },
    "lilyfield": { "state": "NSW", "region": "Inner West" },
    "annandale": { "state": "NSW", "region": "Inner West" },
    "petersham": { "state": "NSW", "region": "Inner West" },
    "stanmore": { "state": "NSW", "region": "Inner West" },
    "enmore": { "state": "NSW", "region": "Inner West" },
    "croydon": { "state": "NSW", "region": "Inner West" },
    "croydon-park": { "state": "NSW", "region": "Inner West" },
    "haberfield": { "state": "NSW", "region": "Inner West" },
    "five-dock": { "state": "NSW", "region": "Inner West" },
    "drummoyne": { "state": "NSW", "region": "Inner West" },
    "glebe": { "state": "NSW", "region": "Inner West" },

    // North Shore
    "chatswood": { "state": "NSW", "region": "North Shore" },
    "st-leonards": { "state": "NSW", "region": "North Shore" },
    "artarmon": { "state": "NSW", "region": "Lower North Shore" },
    "willoughby": { "state": "NSW", "region": "Lower North Shore" },
    "naremburn": { "state": "NSW", "region": "Lower North Shore" },
    "northbridge": { "state": "NSW", "region": "Lower North Shore" },
    "cammeray": { "state": "NSW", "region": "Lower North Shore" },
    "cremorne": { "state": "NSW", "region": "Lower North Shore" },
    "neutral-bay": { "state": "NSW", "region": "Lower North Shore" },
    "mosman": { "state": "NSW", "region": "Lower North Shore" },
    "north-sydney": { "state": "NSW", "region": "Lower North Shore" },
    "kirribilli": { "state": "NSW", "region": "Lower North Shore" },
    "lavender-bay": { "state": "NSW", "region": "Lower North Shore" },
    "wollstonecraft": { "state": "NSW", "region": "Lower North Shore" },
    "greenwich": { "state": "NSW", "region": "Lower North Shore" },
    "lane-cove": { "state": "NSW", "region": "Lower North Shore" },
    "riverview": { "state": "NSW", "region": "Lower North Shore" },
    "longueville": { "state": "NSW", "region": "Lower North Shore" },

    // Upper North Shore
    "gordon": { "state": "NSW", "region": "Upper North Shore" },
    "killara": { "state": "NSW", "region": "Upper North Shore" },
    "lindfield": { "state": "NSW", "region": "Upper North Shore" },
    "roseville": { "state": "NSW", "region": "Upper North Shore" },
    "pymble": { "state": "NSW", "region": "Upper North Shore" },
    "turramurra": { "state": "NSW", "region": "Upper North Shore" },
    "wahroonga": { "state": "NSW", "region": "Upper North Shore" },
    "warrawee": { "state": "NSW", "region": "Upper North Shore" },
    "st-ives": { "state": "NSW", "region": "Upper North Shore" },
    "hornsby": { "state": "NSW", "region": "Upper North Shore" },
    "waitara": { "state": "NSW", "region": "Upper North Shore" },
    "asquith": { "state": "NSW", "region": "Upper North Shore" },
    "berowra": { "state": "NSW", "region": "Upper North Shore" },

    // Northern Suburbs
    "ryde": { "state": "NSW", "region": "Northern Sydney" },
    "eastwood": { "state": "NSW", "region": "Northern Sydney" },
    "epping": { "state": "NSW", "region": "Northern Sydney" },
    "macquarie-park": { "state": "NSW", "region": "Northern Sydney" },
    "north-ryde": { "state": "NSW", "region": "Northern Sydney" },
    "marsfield": { "state": "NSW", "region": "Northern Sydney" },
    "west-ryde": { "state": "NSW", "region": "Northern Sydney" },
    "meadowbank": { "state": "NSW", "region": "Northern Sydney" },
    "denistone": { "state": "NSW", "region": "Northern Sydney" },
    "putney": { "state": "NSW", "region": "Northern Sydney" },
    "gladesville": { "state": "NSW", "region": "Northern Sydney" },
    "hunters-hill": { "state": "NSW", "region": "Northern Sydney" },

    // Northern Beaches
    "manly": { "state": "NSW", "region": "Northern Beaches" },
    "dee-why": { "state": "NSW", "region": "Northern Beaches" },
    "brookvale": { "state": "NSW", "region": "Northern Beaches" },
    "freshwater": { "state": "NSW", "region": "Northern Beaches" },
    "curl-curl": { "state": "NSW", "region": "Northern Beaches" },
    "queenscliff": { "state": "NSW", "region": "Northern Beaches" },
    "fairlight": { "state": "NSW", "region": "Northern Beaches" },
    "balgowlah": { "state": "NSW", "region": "Northern Beaches" },
    "seaforth": { "state": "NSW", "region": "Northern Beaches" },
    "narrabeen": { "state": "NSW", "region": "Northern Beaches" },
    "collaroy": { "state": "NSW", "region": "Northern Beaches" },
    "avalon": { "state": "NSW", "region": "Northern Beaches" },
    "newport": { "state": "NSW", "region": "Northern Beaches" },
    "mona-vale": { "state": "NSW", "region": "Northern Beaches" },
    "palm-beach": { "state": "NSW", "region": "Northern Beaches" },

    // Hills District
    "castle-hill": { "state": "NSW", "region": "Hills District" },
    "baulkham-hills": { "state": "NSW", "region": "Hills District" },
    "bella-vista": { "state": "NSW", "region": "Hills District" },
    "kellyville": { "state": "NSW", "region": "Hills District" },
    "rouse-hill": { "state": "NSW", "region": "Hills District" },
    "pennant-hills": { "state": "NSW", "region": "Hills District" },
    "cherrybrook": { "state": "NSW", "region": "Hills District" },
    "west-pennant-hills": { "state": "NSW", "region": "Hills District" },
    "northmead": { "state": "NSW", "region": "Hills District" },
    "winston-hills": { "state": "NSW", "region": "Hills District" },
    "north-rocks": { "state": "NSW", "region": "Hills District" },
    "carlingford": { "state": "NSW", "region": "Hills District" },

    // Western Sydney
    "parramatta": { "state": "NSW", "region": "Western Sydney" },
    "penrith": { "state": "NSW", "region": "Western Sydney" },
    "blacktown": { "state": "NSW", "region": "Western Sydney" },
    "westmead": { "state": "NSW", "region": "Western Sydney" },
    "wentworthville": { "state": "NSW", "region": "Western Sydney" },
    "toongabbie": { "state": "NSW", "region": "Western Sydney" },
    "seven-hills": { "state": "NSW", "region": "Western Sydney" },
    "kings-langley": { "state": "NSW", "region": "Western Sydney" },
    "kings-park": { "state": "NSW", "region": "Western Sydney" },
    "prospect": { "state": "NSW", "region": "Western Sydney" },
    "girraween": { "state": "NSW", "region": "Western Sydney" },
    "pemulwuy": { "state": "NSW", "region": "Western Sydney" },
    "greystanes": { "state": "NSW", "region": "Western Sydney" },
    "merrylands": { "state": "NSW", "region": "Western Sydney" },
    "guildford": { "state": "NSW", "region": "Western Sydney" },
    "auburn": { "state": "NSW", "region": "Western Sydney" },
    "granville": { "state": "NSW", "region": "Western Sydney" },
    "harris-park": { "state": "NSW", "region": "Western Sydney" },
    "st-marys": { "state": "NSW", "region": "Western Sydney" },
    "mount-druitt": { "state": "NSW", "region": "Western Sydney" },
    "rooty-hill": { "state": "NSW", "region": "Western Sydney" },
    "doonside": { "state": "NSW", "region": "Western Sydney" },
    "quakers-hill": { "state": "NSW", "region": "Western Sydney" },

    // South Western Sydney
    "liverpool": { "state": "NSW", "region": "South Western Sydney" },
    "fairfield": { "state": "NSW", "region": "South Western Sydney" },
    "cabramatta": { "state": "NSW", "region": "South Western Sydney" },
    "bankstown": { "state": "NSW", "region": "South Western Sydney" },
    "revesby": { "state": "NSW", "region": "South Western Sydney" },
    "padstow": { "state": "NSW", "region": "South Western Sydney" },
    "punchbowl": { "state": "NSW", "region": "South Western Sydney" },
    "yagoona": { "state": "NSW", "region": "South Western Sydney" },
    "bass-hill": { "state": "NSW", "region": "South Western Sydney" },
    "chester-hill": { "state": "NSW", "region": "South Western Sydney" },
    "sefton": { "state": "NSW", "region": "South Western Sydney" },
    "birrong": { "state": "NSW", "region": "South Western Sydney" },
    "regents-park": { "state": "NSW", "region": "South Western Sydney" },
    "berala": { "state": "NSW", "region": "South Western Sydney" },
    "lidcombe": { "state": "NSW", "region": "South Western Sydney" },
    "condell-park": { "state": "NSW", "region": "South Western Sydney" },
    "greenacre": { "state": "NSW", "region": "South Western Sydney" },
    "chullora": { "state": "NSW", "region": "South Western Sydney" },
    "villawood": { "state": "NSW", "region": "South Western Sydney" },
    "canley-vale": { "state": "NSW", "region": "South Western Sydney" },
    "canley-heights": { "state": "NSW", "region": "South Western Sydney" },
    "warwick-farm": { "state": "NSW", "region": "South Western Sydney" },
    "casula": { "state": "NSW", "region": "South Western Sydney" },
    "prestons": { "state": "NSW", "region": "South Western Sydney" },
    "hoxton-park": { "state": "NSW", "region": "South Western Sydney" },
    "west-hoxton": { "state": "NSW", "region": "South Western Sydney" },
    "middleton-grange": { "state": "NSW", "region": "South Western Sydney" },

    // St George
    "hurstville": { "state": "NSW", "region": "St George" },
    "kogarah": { "state": "NSW", "region": "St George" },
    "rockdale": { "state": "NSW", "region": "St George" },
    "brighton-le-sands": { "state": "NSW", "region": "St George" },
    "sans-souci": { "state": "NSW", "region": "St George" },
    "ramsgate": { "state": "NSW", "region": "St George" },
    "monterey": { "state": "NSW", "region": "St George" },
    "dolls-point": { "state": "NSW", "region": "St George" },
    "sandringham": { "state": "NSW", "region": "St George" },
    "beverly-hills": { "state": "NSW", "region": "St George" },
    "kingsgrove": { "state": "NSW", "region": "St George" },
    "bexley": { "state": "NSW", "region": "St George" },
    "carlton": { "state": "NSW", "region": "St George" },
    "allawah": { "state": "NSW", "region": "St George" },
    "mortdale": { "state": "NSW", "region": "St George" },
    "penshurst": { "state": "NSW", "region": "St George" },
    "oatley": { "state": "NSW", "region": "St George" },

    // Sutherland Shire
    "cronulla": { "state": "NSW", "region": "Sutherland Shire" },
    "sutherland": { "state": "NSW", "region": "Sutherland Shire" },
    "miranda": { "state": "NSW", "region": "Sutherland Shire" },
    "caringbah": { "state": "NSW", "region": "Sutherland Shire" },
    "gymea": { "state": "NSW", "region": "Sutherland Shire" },
    "engadine": { "state": "NSW", "region": "Sutherland Shire" },
    "sylvania": { "state": "NSW", "region": "Sutherland Shire" },
    "jannali": { "state": "NSW", "region": "Sutherland Shire" },
    "como": { "state": "NSW", "region": "Sutherland Shire" },
    "oyster-bay": { "state": "NSW", "region": "Sutherland Shire" },
    "woolooware": { "state": "NSW", "region": "Sutherland Shire" },
    "loftus": { "state": "NSW", "region": "Sutherland Shire" },
    "yarrawarrah": { "state": "NSW", "region": "Sutherland Shire" },
    "grays-point": { "state": "NSW", "region": "Sutherland Shire" },
    "kirrawee": { "state": "NSW", "region": "Sutherland Shire" },
    "kareela": { "state": "NSW", "region": "Sutherland Shire" },
    "yowie-bay": { "state": "NSW", "region": "Sutherland Shire" },
    "lilli-pilli": { "state": "NSW", "region": "Sutherland Shire" },
    "port-hacking": { "state": "NSW", "region": "Sutherland Shire" },

    // Rest of Australia
    "newcastle": { "state": "NSW", "region": "Hunter Region" },
    "wollongong": { "state": "NSW", "region": "Illawarra" },
    "gosford": { "state": "NSW", "region": "Central Coast" },
    "bathurst": { "state": "NSW", "region": "Central West" },
    "tamworth": { "state": "NSW", "region": "New England" },
    "dubbo": { "state": "NSW", "region": "Central West" },
    "byron-bay": { "state": "NSW", "region": "Northern Rivers" },
    "canberra": { "state": "ACT", "region": "Canberra" },
    "belconnen": { "state": "ACT", "region": "Canberra" },
    "woden": { "state": "ACT", "region": "Canberra" },
    "tuggeranong": { "state": "ACT", "region": "Canberra" },
    "gungahlin": { "state": "ACT", "region": "Canberra" },
    "queanbeyan": { "state": "NSW", "region": "Capital Region" },

    // Victoria
    "melbourne": { "state": "VIC", "region": "Greater Melbourne" },
    "brunswick": { "state": "VIC", "region": "Melbourne Northern" },
    "footscray": { "state": "VIC", "region": "Melbourne Western" },
    "brighton": { "state": "VIC", "region": "Melbourne South Eastern" },
    "geelong": { "state": "VIC", "region": "Regional Victoria" },
    "ballarat": { "state": "VIC", "region": "Regional Victoria" },
    "bendigo": { "state": "VIC", "region": "Regional Victoria" },
    "frankston": { "state": "VIC", "region": "Mornington Peninsula" },
    "st-kilda": { "state": "VIC", "region": "Melbourne Inner" },
    "richmond": { "state": "VIC", "region": "Melbourne Inner" },
    "dandenong": { "state": "VIC", "region": "Melbourne South Eastern" },
    "werribee": { "state": "VIC", "region": "Melbourne Western" },
    "toorak": { "state": "VIC", "region": "Melbourne Eastern" },
    "mildura": { "state": "VIC", "region": "Regional Victoria" },

    // Queensland
    "brisbane": { "state": "QLD", "region": "Greater Brisbane" },
    "gold-coast": { "state": "QLD", "region": "Gold Coast" },
    "sunshine-coast": { "state": "QLD", "region": "Sunshine Coast" },
    "cairns": { "state": "QLD", "region": "Regional Queensland" },
    "townsville": { "state": "QLD", "region": "Regional Queensland" },
    "toowoomba": { "state": "QLD", "region": "Regional Queensland" },
    "mackay": { "state": "QLD", "region": "Regional Queensland" },
    "rockhampton": { "state": "QLD", "region": "Regional Queensland" },
    "bundaberg": { "state": "QLD", "region": "Regional Queensland" },
    "hervey-bay": { "state": "QLD", "region": "Regional Queensland" },
    "southport": { "state": "QLD", "region": "Gold Coast" },
    "west-end": { "state": "QLD", "region": "Brisbane Inner" },
    "fortitude-valley": { "state": "QLD", "region": "Brisbane Inner" },

    // Western Australia
    "perth": { "state": "WA", "region": "Greater Perth" },
    "fremantle": { "state": "WA", "region": "Greater Perth" },
    "joondalup": { "state": "WA", "region": "Perth Northern" },
    "mandurah": { "state": "WA", "region": "Greater Perth" },
    "bunbury": { "state": "WA", "region": "Greater Perth" },
    "geraldton": { "state": "WA", "region": "Greater Perth" },
    "kalgoorlie": { "state": "WA", "region": "Greater Perth" },
    "broome": { "state": "WA", "region": "Greater Perth" },
    "scarborough": { "state": "WA", "region": "Perth Inner" },
    "subiaco": { "state": "WA", "region": "Perth Inner" },

    // South Australia
    "adelaide": { "state": "SA", "region": "Greater Adelaide" },
    "glenelg": { "state": "SA", "region": "Greater Adelaide" },
    "mount-gambier": { "state": "SA", "region": "Greater Adelaide" },
    "whyalla": { "state": "SA", "region": "Greater Adelaide" },
    "port-augusta": { "state": "SA", "region": "Greater Adelaide" },
    "port-lincoln": { "state": "SA", "region": "Greater Adelaide" },
    "victor-harbor": { "state": "SA", "region": "Greater Adelaide" },
    "norwood": { "state": "SA", "region": "Adelaide Inner" },
    "port-adelaide": { "state": "SA", "region": "Greater Adelaide" },

    // Tasmania
    "hobart": { "state": "TAS", "region": "Greater Hobart" },
    "launceston": { "state": "TAS", "region": "Greater Hobart" },
    "devonport": { "state": "TAS", "region": "Greater Hobart" },
    "burnie": { "state": "TAS", "region": "Greater Hobart" },
    "sandy-bay": { "state": "TAS", "region": "Greater Hobart" },
    "kingston": { "state": "TAS", "region": "Greater Hobart" },

    // Northern Territory
    "darwin": { "state": "NT", "region": "Greater Darwin" },
    "alice-springs": { "state": "NT", "region": "Greater Darwin" },
    "palmerston": { "state": "NT", "region": "Greater Darwin" },
    "katherine": { "state": "NT", "region": "Greater Darwin" },
    "nhulunbuy": { "state": "NT", "region": "Greater Darwin" },

    "campbelltown": { "state": "NSW", "region": "Macarthur" }
  };

  const serviceEntries = await getCollection('services');
  const paths = [];

  for (const service of serviceEntries) {
    for (const [suburbSlug, suburbInfo] of Object.entries(suburbsData)) {
      paths.push({
        params: {
          slug: service.slug,
          suburb: suburbSlug
        },
        props: {
          service,
          suburbInfo: {
            slug: suburbSlug,
            ...suburbInfo
          },
          suburbsData
        },
      });
    }
  }

  return paths;
}

// Get the service and suburb data for the current page
const { service, suburbInfo, suburbsData } = Astro.props;
const { Content } = await service.render();

// Format suburb name for display (convert slug to title case)
const formatSuburbName = (slug: string): string => {
  return slug
    .split('-')
    .map((word: string) => word.charAt(0).toUpperCase() + word.slice(1))
    .join(' ');
};

const suburbName = formatSuburbName(suburbInfo.slug);
const cleanServiceName = getCleanServiceName(service.data.title);

// Get region content if available
const regionData = (regionContent as RegionContentData)[suburbInfo.region] || null;

// Get suburb details if available
const suburbData = (suburbDetails as SuburbDetailsData)[suburbInfo.slug] || null;

// Get nearby suburbs for internal linking
const nearbySuburbs = getNearbySuburbs(suburbInfo.slug, suburbInfo.region, suburbsData as SuburbData, 6);

// Get related services in the same category
const allServices = await getCollection('services');
const relatedServices = allServices
  .filter(s =>
    s.data.category === service.data.category &&
    s.slug !== service.slug
  )
  .slice(0, 3);

// Get related blog posts
const allBlogPosts = await getCollection('blog');
const relatedBlogPosts = getRelatedBlogPosts(service.data.keywords || [], allBlogPosts, 3);

// Create a title and description with the suburb name
const baseTitle = service.data.title.replace(/{suburb}/g, suburbName);
const baseDescription = service.data.description.replace(/{suburb}/g, suburbName);

// Get quickFacts if available
const quickFacts = service.data.quickFacts;

// Build optimized meta title (max ~50 chars before brand addition)
// Format: "{Service} {Suburb} - From ${Price}/hr"
const priceMatch = quickFacts?.costRange?.match(/\$[\d]+/);
const priceSignal = priceMatch ? ` - From ${priceMatch[0]}/hr` : '';
const title = `${cleanServiceName} ${suburbName}${priceSignal}`;

// H1 title - benefit-focused, slightly longer allowed
const h1Title = baseTitle.replace(/\s*\|.*$/, ''); // Remove anything after pipe

// Enhanced meta description with benefits, location, and CTA
const description = `${baseDescription} Local ${suburbInfo.region} team. ${quickFacts?.fundingOptions ? `Funded via ${quickFacts.fundingOptions.split(',')[0]}.` : 'NDIS & HCP approved.'} Call 08 6386 9999.`;

// Build canonical URL (self-referencing to maintain long-tail rankings)
const canonicalUrl = `https://mdhomecare.com.au/services/${service.slug}/${suburbInfo.slug}`;

// Build breadcrumb data
const breadcrumbs = [
  { name: 'Home', url: 'https://mdhomecare.com.au' },
  { name: 'Services', url: 'https://mdhomecare.com.au/services' },
  { name: cleanServiceName, url: `https://mdhomecare.com.au/services/${service.slug}` },
  { name: suburbName, url: canonicalUrl }
];

// Build Service schema with AggregateRating for rich results
const serviceSchema = {
  "@type": "Service",
  "@id": `${canonicalUrl}#service`,
  "name": baseTitle,
  "description": baseDescription,
  "provider": {
    "@type": "LocalBusiness",
    "@id": "https://mdhomecare.com.au/#organization",
    "name": "MD Home Care",
    "telephone": "+61863869999",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "6/11 York St",
      "addressLocality": "Sydney",
      "addressRegion": "NSW",
      "postalCode": "2000",
      "addressCountry": "AU"
    }
  },
  "areaServed": {
    "@type": "City",
    "name": suburbName,
    "containedInPlace": {
      "@type": "State",
      "name": suburbInfo.state === "NSW" ? "New South Wales" :
              suburbInfo.state === "VIC" ? "Victoria" :
              suburbInfo.state === "QLD" ? "Queensland" :
              suburbInfo.state === "WA" ? "Western Australia" :
              suburbInfo.state === "SA" ? "South Australia" :
              suburbInfo.state === "TAS" ? "Tasmania" :
              suburbInfo.state === "NT" ? "Northern Territory" :
              suburbInfo.state === "ACT" ? "Australian Capital Territory" : suburbInfo.state
    }
  },
  "serviceType": service.data.category,
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.8",
    "reviewCount": "127",
    "bestRating": "5",
    "worstRating": "1"
  },
  ...(quickFacts?.costRange && {
    "offers": {
      "@type": "Offer",
      "description": quickFacts.costRange,
      "priceCurrency": "AUD",
      "availability": "https://schema.org/InStock"
    }
  })
};

// Build BreadcrumbList schema
const breadcrumbSchema = {
  "@type": "BreadcrumbList",
  "itemListElement": breadcrumbs.map((item, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "name": item.name,
    ...(index < breadcrumbs.length - 1 ? { "item": item.url } : {})
  }))
};

// Build FAQ schema (service-specific)
const faqSchema = {
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": `What does ${cleanServiceName} cost in ${suburbName}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": quickFacts?.costRange
          ? `${cleanServiceName} in ${suburbName} typically costs ${quickFacts.costRange}. Funding options include ${quickFacts.fundingOptions || 'NDIS, Home Care Packages, and private payment'}. Contact us for a personalized quote.`
          : `The cost of ${cleanServiceName} in ${suburbName} varies based on your individual needs and funding arrangement. We offer services through NDIS, Home Care Packages, DVA, and private payment options. Contact us for a personalized assessment and quote.`
      }
    },
    {
      "@type": "Question",
      "name": `How do I access ${cleanServiceName} in ${suburbName}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": `To access ${cleanServiceName} in ${suburbName}, contact MD Home Care on 08 6386 9999 or through our website. We'll arrange a free consultation to assess your needs, discuss funding options (NDIS, Home Care Packages, or private), and match you with qualified local support workers.`
      }
    },
    {
      "@type": "Question",
      "name": `Do you have local care workers in ${suburbName}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": `Yes, we have qualified care workers based in ${suburbName} and the ${suburbInfo.region} area. All our team members are fully qualified, police-checked, and insured. They understand the local community and can provide consistent, reliable care.`
      }
    },
    {
      "@type": "Question",
      "name": `What funding options are available for ${cleanServiceName} in ${suburbName}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": quickFacts?.fundingOptions
          ? `In ${suburbName}, ${cleanServiceName} can be funded through: ${quickFacts.fundingOptions}. Our team can help you understand your eligibility and navigate the funding process.`
          : `In ${suburbName}, our services can be accessed through NDIS (National Disability Insurance Scheme), Home Care Packages, DVA (Department of Veterans' Affairs), CHSP (Commonwealth Home Support Programme), or private payment. We can help you understand your eligibility for different funding options.`
      }
    },
    {
      "@type": "Question",
      "name": `How quickly can I start ${cleanServiceName} in ${suburbName}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": quickFacts?.waitTime
          ? `For ${cleanServiceName} in ${suburbName}, ${quickFacts.waitTime.toLowerCase()}. For urgent needs, we prioritize rapid response. Contact us to discuss your timeline.`
          : `We aim to begin services as quickly as possible. After your initial consultation, we typically start within 1-2 weeks, though urgent requests can often be accommodated sooner. Contact us to discuss your specific needs.`
      }
    }
  ]
};

// HowTo schema for process-oriented services
const howToSchema = {
  "@type": "HowTo",
  "@id": `${canonicalUrl}#howto`,
  "name": `How to Access ${cleanServiceName} in ${suburbName}`,
  "description": `Step-by-step guide to getting ${cleanServiceName.toLowerCase()} support in ${suburbName} through MD Home Care.`,
  "totalTime": "P14D",
  "estimatedCost": {
    "@type": "MonetaryAmount",
    "currency": "AUD",
    "value": "0",
    "description": "Free consultation - services may be funded through NDIS, Home Care Packages, or DVA"
  },
  "step": [
    {
      "@type": "HowToStep",
      "position": 1,
      "name": "Contact Us for a Free Consultation",
      "text": `Call us on 08 6386 9999 or submit an enquiry online. Our ${suburbInfo.region} team will discuss your needs and explain your options.`,
      "url": "https://mdhomecare.com.au/contact"
    },
    {
      "@type": "HowToStep",
      "position": 2,
      "name": "Needs Assessment",
      "text": `We'll conduct a thorough assessment to understand your ${cleanServiceName.toLowerCase()} requirements in ${suburbName} and create a personalised care plan.`
    },
    {
      "@type": "HowToStep",
      "position": 3,
      "name": "Funding Confirmation",
      "text": "We help you navigate NDIS, Home Care Packages, DVA, or private payment options to fund your services."
    },
    {
      "@type": "HowToStep",
      "position": 4,
      "name": "Support Worker Matching",
      "text": `We match you with a qualified support worker in ${suburbName} based on your needs, preferences, and personality.`
    },
    {
      "@type": "HowToStep",
      "position": 5,
      "name": "Services Begin",
      "text": quickFacts?.waitTime
        ? `Your ${cleanServiceName.toLowerCase()} services begin. ${quickFacts.waitTime}`
        : `Your ${cleanServiceName.toLowerCase()} services begin, typically within 1-2 weeks of your initial consultation.`
    }
  ]
};

// Combine all schemas
const combinedSchema = {
  "@context": "https://schema.org",
  "@graph": [serviceSchema, breadcrumbSchema, faqSchema, howToSchema]
};
---

<script type="application/ld+json" set:html={JSON.stringify(combinedSchema)}></script>

<BaseLayout
  title={title}
  description={description}
  canonical={canonicalUrl}
>
  <div class="w-full">
    <article>
      <!-- Hero Section -->
      <header class="relative min-h-[85vh] flex items-center justify-center overflow-hidden pt-20">
          <!-- Background Image with Overlay -->
          <div class="absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed top-0" style={service.data.image ? `background-image: url(${service.data.image})` : 'background-color: oklch(var(--b2))'}></div>
          <div class="absolute inset-0 bg-gradient-to-b from-black/30 via-black/10 to-base-100 top-0"></div>

          <!-- Glass Console Frame -->
          <div class="container-custom relative z-10 px-4 py-12">
            <div class="max-w-4xl mx-auto bg-white/80 backdrop-blur-xl rounded-[2.5rem] border border-white/50 shadow-2xl p-8 md:p-12 lg:p-16 text-center">
              
              <!-- Location Tags -->
              <div class="flex flex-wrap justify-center items-center gap-3 mb-8">
                <span class="inline-flex items-center px-4 py-1.5 rounded-full bg-primary/10 text-primary text-sm font-bold tracking-wide uppercase">
                  {service.data.category}
                </span>
                <span class="inline-flex items-center px-4 py-1.5 rounded-full border-2 border-base-200 text-secondary text-sm font-semibold">
                  <Icon name="hugeicons:location-01" class="h-4 w-4 mr-1.5 text-primary" />
                  {suburbInfo.region}, {suburbInfo.state}
                </span>
              </div>

              <!-- Title -->
              <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold text-secondary mb-6 leading-[1.1] tracking-tight text-balance">
                {h1Title}
              </h1>

              <!-- Description -->
              <p class="text-xl text-secondary/70 font-medium mb-10 leading-relaxed max-w-2xl mx-auto text-balance">
                {description}
              </p>

              <!-- CTA Buttons -->
              <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="tel:+61863869999" class="btn btn-primary btn-lg rounded-full px-8 text-lg font-bold shadow-lg shadow-primary/20 hover:shadow-xl hover:shadow-primary/30 hover:-translate-y-1 transition-all duration-300">
                   <Icon name="hugeicons:call-02" class="h-6 w-6 mr-2" />
                   08 6386 9999
                </a>
                <a href="/contact#contact-form" class="btn btn-lg bg-white text-secondary border-2 border-base-200 hover:border-primary hover:text-primary rounded-full px-8 transition-all duration-300">
                  Send Message
                </a>
              </div>

               <!-- Trust Signal -->
              <div class="mt-10 pt-8 border-t border-base-200/50 flex justify-center items-center gap-2">
                 <div class="flex text-warning">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" /></svg>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" /></svg>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" /></svg>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" /></svg>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" /></svg>
                 </div>
                 <span class="text-sm font-semibold text-secondary/70">4.8 (127 verified reviews)</span>
              </div>

            </div>
          </div>
      </header>

      <!-- Breadcrumb Navigation -->
      <nav class="max-w-6xl mx-auto px-4 py-6" aria-label="Breadcrumb">
        <ol class="flex flex-wrap items-center gap-2 text-sm font-medium">
          {breadcrumbs.map((item, index) => (
            <li class="flex items-center">
              {index > 0 && (
                <Icon name="hugeicons:arrow-right-01" class="h-4 w-4 mx-2 text-base-content/40" />
              )}
              {index === breadcrumbs.length - 1 ? (
                <span class="text-base-content/60">{item.name}</span>
              ) : (
                <a href={item.url} class="text-primary hover:underline transition-colors">{item.name}</a>
              )}
            </li>
          ))}
        </ol>
      </nav>

      <!-- Eligibility Checker Template -->
      <div id="eligibility-checker-template" class="hidden">
        <EligibilityChecker />
      </div>

      <!-- Main Content -->
      <div class="max-w-4xl mx-auto px-4 py-20" id="learn-more">
        
        <!-- Quick Facts Box -->
        {quickFacts && (
          <div class="bg-white rounded-[2.5rem] shadow-xl shadow-base-200/50 border-2 border-base-200 p-8 mb-12 transform hover:scale-[1.01] transition-transform duration-300">
             <QuickFacts
              serviceName={cleanServiceName}
              suburb={suburbName}
              costRange={quickFacts.costRange}
              fundingOptions={quickFacts.fundingOptions}
              availability={quickFacts.availability}
              serviceHours={quickFacts.serviceHours}
              waitTime={quickFacts.waitTime}
            />
          </div>
        )}

        <!-- Region-Specific Content -->
        {regionData && (
          <div class="bg-white border-2 border-base-200 shadow-xl shadow-base-200/50 rounded-[2.5rem] p-8 md:p-12 mb-12">
            <h2 class="text-2xl font-bold text-secondary mb-6 flex items-center gap-3">
              <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary">
                 <Icon name="hugeicons:location-01" class="h-5 w-5" />
              </div>
              About Our {suburbInfo.region} Team
            </h2>
            <p class="text-secondary/80 mb-6 leading-relaxed text-lg">{regionData.localInsight}</p>
            
            <div class="flex flex-col sm:flex-row gap-4">
              {regionData.transportNote && (
                <div class="flex items-start gap-3 p-4 bg-base-100 rounded-2xl border border-base-200 flex-1">
                  <Icon name="hugeicons:bus-01" class="h-5 w-5 mt-0.5 text-primary shrink-0" />
                  <div>
                    <span class="block font-bold text-sm text-secondary uppercase tracking-wide mb-1">Transport</span>
                    <span class="text-secondary/70 text-sm">{regionData.transportNote}</span>
                  </div>
                </div>
              )}
              {suburbData?.nearestHospital && (
                 <div class="flex items-start gap-3 p-4 bg-base-100 rounded-2xl border border-base-200 flex-1">
                  <Icon name="hugeicons:hospital-01" class="h-5 w-5 mt-0.5 text-primary shrink-0" />
                  <div>
                    <span class="block font-bold text-sm text-secondary uppercase tracking-wide mb-1">Nearest Hospital</span>
                    <span class="text-secondary/70 text-sm">{suburbData.nearestHospital}</span>
                  </div>
                </div>
              )}
            </div>
          </div>
        )}

        <!-- Local Resources Section -->
        {suburbData && (suburbData.medicalCentres || suburbData.communityGroups || suburbData.accessibilityNotes || suburbData.demographicNotes) && (
          <div class="mb-16">
            <h2 class="text-2xl font-bold text-secondary mb-8 flex items-center gap-3">
              <Icon name="hugeicons:building-02" class="h-8 w-8 text-primary" />
              Local Resources in {suburbName}
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Demographic & Community Info -->
              {suburbData.demographicNotes && (
                <div class="bg-white border-2 border-base-200 rounded-3xl p-6">
                  <h3 class="font-bold text-secondary text-sm uppercase tracking-wide mb-3 flex items-center gap-2">
                    <Icon name="hugeicons:user-group" class="h-4 w-4 text-primary" />
                    Community
                  </h3>
                  <p class="text-secondary/70 text-sm leading-relaxed">{suburbData.demographicNotes}</p>
                </div>
              )}

              <!-- Accessibility Info -->
              {suburbData.accessibilityNotes && (
                <div class="bg-white border-2 border-base-200 rounded-3xl p-6">
                  <h3 class="font-bold text-secondary text-sm uppercase tracking-wide mb-3 flex items-center gap-2">
                    <Icon name="hugeicons:wheelchair" class="h-4 w-4 text-primary" />
                    Accessibility
                  </h3>
                  <p class="text-secondary/70 text-sm leading-relaxed">{suburbData.accessibilityNotes}</p>
                </div>
              )}

              <!-- Local Medical Centres -->
              {suburbData.medicalCentres && suburbData.medicalCentres.length > 0 && (
                <div class="bg-white border-2 border-base-200 rounded-3xl p-6">
                  <h3 class="font-bold text-secondary text-sm uppercase tracking-wide mb-3 flex items-center gap-2">
                    <Icon name="hugeicons:hospital-01" class="h-4 w-4 text-primary" />
                    Medical Centres
                  </h3>
                  <ul class="text-sm text-secondary/70 space-y-2">
                    {suburbData.medicalCentres.slice(0, 3).map((centre: string) => (
                      <li class="flex items-start gap-2">
                        <div class="w-1.5 h-1.5 rounded-full bg-primary/40 mt-1.5 shrink-0"></div>
                        {centre}
                      </li>
                    ))}
                  </ul>
                </div>
              )}

              <!-- Local Pharmacies -->
              {suburbData.pharmacies && suburbData.pharmacies.length > 0 && (
                <div class="bg-white border-2 border-base-200 rounded-3xl p-6">
                  <h3 class="font-bold text-secondary text-sm uppercase tracking-wide mb-3 flex items-center gap-2">
                    <Icon name="hugeicons:medicine-bottle-01" class="h-4 w-4 text-primary" />
                    Pharmacies
                  </h3>
                  <ul class="text-sm text-secondary/70 space-y-2">
                    {suburbData.pharmacies.slice(0, 3).map((pharmacy: string) => (
                      <li class="flex items-start gap-2">
                        <div class="w-1.5 h-1.5 rounded-full bg-primary/40 mt-1.5 shrink-0"></div>
                        {pharmacy}
                      </li>
                    ))}
                  </ul>
                </div>
              )}

              <!-- Public Transport -->
              {suburbData.publicTransport && suburbData.publicTransport.length > 0 && (
                <div class="bg-white border-2 border-base-200 rounded-3xl p-6">
                  <h3 class="font-bold text-secondary text-sm uppercase tracking-wide mb-3 flex items-center gap-2">
                    <Icon name="hugeicons:bus-01" class="h-4 w-4 text-primary" />
                    Transport
                  </h3>
                  <ul class="text-sm text-secondary/70 space-y-2">
                    {suburbData.publicTransport.slice(0, 3).map((route: string) => (
                      <li class="flex items-start gap-2">
                        <div class="w-1.5 h-1.5 rounded-full bg-primary/40 mt-1.5 shrink-0"></div>
                        {route}
                      </li>
                    ))}
                  </ul>
                </div>
              )}

              <!-- Community Groups -->
              {suburbData.communityGroups && suburbData.communityGroups.length > 0 && (
                <div class="bg-white border-2 border-base-200 rounded-3xl p-6">
                  <h3 class="font-bold text-secondary text-sm uppercase tracking-wide mb-3 flex items-center gap-2">
                    <Icon name="hugeicons:user-group" class="h-4 w-4 text-primary" />
                    Support Groups
                  </h3>
                  <ul class="text-sm text-secondary/70 space-y-2">
                    {suburbData.communityGroups.slice(0, 3).map((group: string) => (
                      <li class="flex items-start gap-2">
                        <div class="w-1.5 h-1.5 rounded-full bg-primary/40 mt-1.5 shrink-0"></div>
                        {group}
                      </li>
                    ))}
                  </ul>
                </div>
              )}
            </div>

            <!-- Local Council Info -->
            {(suburbData.localCouncil || suburbData.postcode) && (
              <div class="mt-6 p-4 bg-base-200 rounded-2xl flex flex-wrap gap-4 text-xs font-medium text-secondary/60 uppercase tracking-wide border border-base-200">
                {suburbData.localCouncil && (
                  <span>Council: {suburbData.localCouncil}</span>
                )}
                {suburbData.postcode && (
                  <span>Postcode: {suburbData.postcode}</span>
                )}
                {suburbData.population && (
                  <span>Pop: {suburbData.population}</span>
                )}
              </div>
            )}
          </div>
        )}

        <div class="prose prose-lg max-w-none prose-headings:font-bold prose-h2:text-3xl prose-h2:text-secondary prose-p:text-secondary/70 prose-li:text-secondary/70" id="content-container" data-suburb={suburbName}>
          <Content />
        </div>

        <!-- Suburb Testimonials -->
        <div class="mt-16">
            <SuburbTestimonials
            suburbSlug={suburbInfo.slug}
            suburbName={suburbName}
            regionSlug={suburbInfo.region.toLowerCase().replace(/\s+/g, '-').split(' ')[0]}
            maxTestimonials={2}
            />
        </div>

        <!-- CTA Banner -->
        <div class="bg-primary text-primary-content my-16 shadow-2xl shadow-primary/20 rounded-[2.5rem] p-8 md:p-12 relative overflow-hidden">
             <!-- Decorative blobs -->
            <div class="absolute top-0 right-0 -translate-y-1/2 translate-x-1/3 w-64 h-64 bg-white/10 rounded-full blur-3xl pointer-events-none"></div>
            <div class="absolute bottom-0 left-0 translate-y-1/2 -translate-x-1/3 w-64 h-64 bg-white/10 rounded-full blur-3xl pointer-events-none"></div>
            
          <div class="flex flex-col md:flex-row items-center justify-between w-full gap-8 relative z-10">
            <div class="text-center md:text-left">
              <h3 class="font-bold text-2xl md:text-3xl mb-2">Ready to start in {suburbName}?</h3>
              <p class="text-primary-content/90 text-lg">Contact our local {suburbInfo.region} team today.</p>
            </div>
            <a href="/contact#contact-form" class="btn btn-lg bg-white text-primary border-none hover:bg-base-100 rounded-full px-8 shadow-lg shrink-0">
              Get Started
            </a>
          </div>
        </div>
      </div>

      <!-- Nearby Suburbs Section -->
      {nearbySuburbs.length > 0 && (
        <section class="bg-base-200 py-24 px-4 border-t border-base-200">
          <div class="max-w-6xl mx-auto">
            <h2 class="text-2xl font-bold text-secondary mb-8 text-center">
              {cleanServiceName} in Nearby {suburbInfo.region} Locations
            </h2>
            <div class="flex flex-wrap justify-center gap-3">
              {nearbySuburbs.map((nearby) => (
                <a
                  href={`/services/${service.slug}/${nearby.slug}`}
                  class="btn btn-outline border-2 border-base-200 bg-white hover:bg-base-100 hover:border-primary text-secondary font-medium rounded-full px-6 transition-all"
                >
                  {nearby.name}
                </a>
              ))}
            </div>
          </div>
        </section>
      )}

      <!-- Related Services -->
      {relatedServices.length > 0 && (
        <section class="bg-white py-24 px-4 border-t border-base-200">
          <div class="max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold text-center text-secondary mb-16">Related Services in {suburbName}</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
              {relatedServices.map((relatedService) => (
                <a href={`/services/${relatedService.slug}/${suburbInfo.slug}`} class="card bg-white rounded-[2.5rem] shadow-lg shadow-base-200/50 border-2 border-base-200 hover:border-primary/50 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 group overflow-hidden">
                  <div class="card-body p-8">
                    <div class="w-12 h-12 rounded-2xl bg-primary/10 flex items-center justify-center text-primary mb-6 group-hover:scale-110 transition-transform">
                        <Icon name="hugeicons:star" class="h-6 w-6" /> 
                    </div>
                    <h3 class="card-title text-xl font-bold text-secondary mb-3 group-hover:text-primary transition-colors">{relatedService.data.title.replace(/{suburb}/g, suburbName)}</h3>
                    <p class="text-secondary/60 text-sm line-clamp-3 leading-relaxed mb-6">{relatedService.data.description.replace(/{suburb}/g, suburbName)}</p>
                    <span class="text-primary font-bold text-sm inline-flex items-center gap-2 mt-auto">
                      View Service
                      <Icon name="hugeicons:arrow-right-01" class="h-4 w-4 transition-transform group-hover:translate-x-1" />
                    </span>
                  </div>
                </a>
              ))}
            </div>
          </div>
        </section>
      )}

      <!-- Related Blog Posts -->
      {relatedBlogPosts.length > 0 && (
        <section class="bg-base-200 py-24 px-4 border-t border-base-200">
          <div class="max-w-6xl mx-auto">
            <h2 class="text-2xl font-bold text-secondary mb-12 text-center">Helpful Resources</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
              {relatedBlogPosts.map((post) => (
                <a href={`/blog/${post.slug}`} class="card bg-white rounded-[2rem] border border-base-200 hover:border-primary/50 hover:shadow-lg transition-all duration-300 group overflow-hidden">
                  <div class="aspect-[16/9] overflow-hidden relative">
                     <img src={post.data.image || '/assets/homecare.webp'} alt={post.data.title} class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" />
                  </div>
                  <div class="card-body p-6">
                    <h3 class="card-title text-lg font-bold text-secondary mb-2 line-clamp-2 group-hover:text-primary transition-colors">{post.data.title}</h3>
                    <p class="text-sm text-secondary/60 line-clamp-2 leading-relaxed">{post.data.description}</p>
                  </div>
                </a>
              ))}
            </div>
          </div>
        </section>
      )}

      <!-- Footer Navigation -->
      <footer class="max-w-6xl mx-auto py-12 px-4 border-t border-base-200">
        <div class="flex flex-col sm:flex-row justify-center gap-4">
          <a href="/services" class="btn btn-ghost gap-2 rounded-full hover:bg-base-100 text-secondary/70 hover:text-primary transition-colors">
            <Icon name="hugeicons:arrow-left-01" class="h-5 w-5" />
            Back to Services
          </a>
          <a href={`/services/${service.slug}`} class="btn btn-ghost gap-2 rounded-full hover:bg-base-100 text-secondary/70 hover:text-primary transition-colors">
            <Icon name="hugeicons:location-01" class="h-5 w-5" />
            View All Locations
          </a>
        </div>
      </footer>
    </article>
  </div>
</BaseLayout>

<style>
  @reference "../../../../styles/global.css";

  /* iOS fix for background images */
  @supports (-webkit-touch-callout: none) {
    header {
      background-attachment: scroll !important;
    }
  }

  /* Prose styling enhancements */
  .prose h2 {
    @apply text-2xl md:text-3xl font-bold mt-12 mb-6 text-secondary border-b border-base-200 pb-4;
  }

  .prose h3 {
    @apply text-xl font-bold mt-10 mb-4 text-secondary;
  }

  .prose h4 {
    @apply text-lg font-bold mt-8 mb-3 text-secondary;
  }

  .prose p {
    @apply mb-6 text-secondary/70 leading-relaxed text-lg;
  }

  .prose ul, .prose ol {
    @apply mb-6 pl-6 space-y-2;
  }

  .prose ul {
    @apply list-disc marker:text-primary;
  }

  .prose ol {
    @apply list-decimal marker:text-primary font-bold;
  }

  .prose li {
    @apply mb-2 pl-2 text-secondary/70 text-lg;
  }

  .prose a {
    @apply link link-primary font-bold no-underline hover:underline;
  }

  .prose blockquote {
    @apply border-l-4 border-primary pl-6 py-4 my-8 bg-base-200 rounded-r-2xl italic text-xl text-secondary font-medium shadow-sm;
  }

  .prose code {
    @apply bg-base-100 px-2 py-1 rounded-md text-sm font-mono text-primary;
  }

  .prose img {
    @apply rounded-[2rem] shadow-xl my-10 w-full;
  }

  .prose hr {
    @apply border-base-200 my-12;
  }
</style>

<script define:vars={{ suburbName }}>
document.addEventListener('DOMContentLoaded', () => {
  const contentContainer = document.getElementById('content-container');

  // Function to replace text in an element and its children
  const replaceText = (element, find, replace) => {
    if (element.tagName === 'SCRIPT' || element.tagName === 'STYLE') return;

    if (element.nodeType === Node.TEXT_NODE) {
      const newText = element.textContent.replace(new RegExp(find, 'g'), replace);
      if (element.textContent !== newText) {
        element.textContent = newText;
      }
      return;
    }

    for (const child of element.childNodes) {
      replaceText(child, find, replace);
    }
  };

  // Replace in content container
  if (contentContainer) {
    replaceText(contentContainer, '{suburb}', suburbName);
  }

  // Inject eligibility checker after the second paragraph
  const injectEligibilityChecker = () => {
    const eligibilityTemplate = document.getElementById('eligibility-checker-template');

    if (contentContainer && eligibilityTemplate) {
      const paragraphs = contentContainer.querySelectorAll('p');

      if (paragraphs.length >= 2) {
        const eligibilityChecker = eligibilityTemplate.cloneNode(true);
        eligibilityChecker.id = 'eligibility-checker-injected';
        eligibilityChecker.classList.remove('hidden');
        eligibilityChecker.classList.add('my-12');

        const secondParagraph = paragraphs[1];
        secondParagraph.parentNode.insertBefore(eligibilityChecker, secondParagraph.nextSibling);
      }
    }
  };

  setTimeout(injectEligibilityChecker, 100);
});
</script>