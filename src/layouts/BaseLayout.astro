---
// Import global styles (Tailwind CSS 4 + DaisyUI 5)
import '../styles/global.css';
import { Icon } from 'astro-icon/components';

// Define the props interface
interface Props {
  title: string;
  description?: string;
  image?: string;
  canonical?: string;
  noindex?: boolean;
  nofollow?: boolean;
  metaTitle?: string;
  metaDescription?: string;
}

// Destructure props with defaults
const {
  title: rawTitle,
  description = "Providing compassionate and professional home care services",
  image = "/images/default-social.jpg",
  canonical = Astro.url.href,
  noindex = false,
  nofollow = false,
  metaTitle,
  metaDescription
} = Astro.props;

// Smart title construction - add brand suffix if not already present and title is short enough
const brandSuffix = " | MD Home Care";
const title = rawTitle.includes("MD Home Care") || rawTitle.includes("MD Homecare")
  ? rawTitle
  : rawTitle.length + brandSuffix.length <= 65
    ? rawTitle + brandSuffix
    : rawTitle;

// Import getCollection to fetch blog posts
import { getCollection } from 'astro:content';
import { SEO } from 'astro-seo';
// Import PostHog component
import PostHog from '../components/posthog.astro';

// Get blog posts, sort by date, and take the 5 most recent
const allBlogPosts = await getCollection('blog');
const recentBlogPosts = allBlogPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 5);

// Format dates for display
function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
}

// Generate JSON-LD structured data for organization
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": "MD Homecare",
  "url": "https://mdhomecare.com.au",
  "logo": "https://mdhomecare.com.au/assets/logo.svg",
  "image": "https://mdhomecare.com.au/assets/logo.svg",
  "description": "Professional NDIS home care services in Melbourne & Sydney. MD Homecare offers disability homecare support, domiciliary care services, SIL, and community participation.",
  "telephone": "+61405429512",
  "priceRange": "$$",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "6/11 York St",
    "addressLocality": "Sydney",
    "addressRegion": "NSW",
    "postalCode": "2000",
    "addressCountry": "AU"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": -33.8651,
    "longitude": 151.2069
  },
  "sameAs": [
    "https://www.facebook.com/mdhomecare",
    "https://www.instagram.com/mdhomecare"
  ],
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.8",
    "ratingCount": "15",
    "bestRating": "5",
    "worstRating": "1"
  },
  "review": [
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Sarah Thompson"
      },
      "datePublished": "2023-10-15",
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "MD Homecare's support workers have been amazing for my daughter. They're incredibly patient, caring, and reliable. I couldn't ask for better NDIS support."
    },
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Michael Johnson"
      },
      "datePublished": "2023-09-22",
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "The team at MD Homecare has made such a difference in my life. Their in-home disability support services are personalized and professional."
    },
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Emma Wilson"
      },
      "datePublished": "2023-11-08",
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "4",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "Very satisfied with the domestic assistance services. The support workers are always on time and do a thorough job."
    }
  ]
};

const structuredDataOrg = JSON.stringify(organizationSchema);
---

<!DOCTYPE html>
<html lang="en" data-theme="mdhomecare">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content={Astro.generator}>

    <SEO
      title={metaTitle || title}
      description={metaDescription || description}
      canonical={canonical}
      openGraph={{
        basic: {
          title: metaTitle || title,
          type: "website",
          image: image,
          url: Astro.url,
        },
        optional: {
          description: metaDescription || description,
          locale: "en_AU",
          siteName: "MD Homecare",
        },
        image: {
          alt: "MD Homecare website image",
        },
        article: {
          publishedTime: new Date().toISOString(),
          tags: ["homecare", "NDIS", "disability", "support"],
        },
      }}
      twitter={{
        card: "summary_large_image",
        title: title,
        description: description,
        image: image,
        imageAlt: "MD Homecare website image",
        site: "@mdhomecare",
        creator: "@mdhomecare",
      }}
      extend={{
        link: [
          { rel: "icon", type: "image/svg+xml", href: "/favicon.svg" },
          { rel: "apple-touch-icon", href: "/apple-touch-icon.png" },
          { rel: "manifest", href: "/manifest.json" },
        ],
        meta: [
          { name: "generator", content: Astro.generator },
          { name: "robots", content: noindex ? "noindex" : "index,follow" },
          { name: "robots", content: nofollow ? "nofollow" : undefined },
          { name: "theme-color", content: "#0f172a" },
          { name: "apple-mobile-web-app-capable", content: "yes" },
          { name: "apple-mobile-web-app-status-bar-style", content: "black-translucent" },
          { name: "author", content: "MD Homecare" },
        ],
      }}
    />

    <!-- Organization LocalBusiness Structured Data -->
    <script type="application/ld+json" set:html={structuredDataOrg} />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-05DBKL39SX"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-05DBKL39SX');
    </script>

    <!-- PostHog Analytics -->
    <PostHog />
  </head>
  <body class="min-h-screen bg-base-100">
    <!-- DaisyUI Navbar with Drawer for Mobile -->
    <div class="drawer">
      <input id="mobile-drawer" type="checkbox" class="drawer-toggle" />

      <div class="drawer-content flex flex-col">
        <!-- Navbar -->
        <header class="navbar bg-secondary text-secondary-content sticky top-0 z-50 px-4 lg:px-8 min-h-16">
          <!-- Mobile/Tablet: Menu button on left -->
          <div class="navbar-start">
            <label for="mobile-drawer" class="btn btn-ghost btn-sm btn-square lg:hidden" aria-label="Open menu">
              <Icon name="hugeicons:menu-02" class="h-5 w-5" />
            </label>

            <!-- Desktop Logo (lg and up) -->
            <a href="/" class="hidden lg:flex items-center gap-3 hover:opacity-90 transition-opacity">
              <img src="/assets/logo.svg" alt="MD Homecare Logo" class="h-9 w-auto flex-shrink-0" />
              <div class="flex flex-col">
                <span class="text-lg font-bold text-info leading-tight whitespace-nowrap">MD Homecare</span>
                <span class="text-xs text-secondary-content/70 leading-tight whitespace-nowrap">Empowering Independence</span>
              </div>
            </a>
          </div>

          <!-- Mobile/Tablet: Centered Logo -->
          <div class="navbar-center lg:hidden">
            <a href="/" class="flex items-center gap-2 hover:opacity-90 transition-opacity">
              <img src="/assets/logo.svg" alt="MD Homecare Logo" class="h-8 w-auto flex-shrink-0" />
              <span class="text-base font-bold text-info whitespace-nowrap">MD Homecare</span>
            </a>
          </div>

          <!-- Desktop Navigation (lg and up) -->
          <div class="navbar-center hidden lg:flex">
            <ul class="menu menu-horizontal px-1 gap-1">
              <li><a href="/" class="font-medium hover:text-info">Home</a></li>

              <!-- Services Dropdown -->
              <li>
                <div class="dropdown dropdown-hover dropdown-bottom">
                  <div tabindex="0" role="button" class="font-medium hover:text-info flex items-center gap-1 cursor-pointer">
                    Services
                    <Icon name="hugeicons:arrow-down-01" class="h-4 w-4" />
                  </div>
                  <div tabindex="0" class="dropdown-content z-[100] bg-base-100 shadow-2xl rounded-box w-[700px] p-0 mt-0 left-1/2 -translate-x-1/2">
                    <div class="grid grid-cols-4 gap-0">
                      <!-- Personal Support -->
                      <div class="p-5 border-r border-base-200">
                        <h4 class="font-semibold text-primary mb-3 text-sm">Personal Support</h4>
                        <div class="flex flex-col gap-0.5">
                          <a href="/services/disability-services" class="block py-1.5 text-base-content/80 hover:text-primary transition-colors text-sm">Disability Services</a>
                          <a href="/services/personal-care" class="block py-1.5 text-base-content/80 hover:text-primary transition-colors text-sm">Personal Care</a>
                          <a href="/services/clinical-care" class="block py-1.5 text-base-content/80 hover:text-primary transition-colors text-sm">Clinical Care</a>
                          <a href="/services/support-workers" class="block py-1.5 text-base-content/80 hover:text-primary transition-colors text-sm">Support Workers</a>
                        </div>
                      </div>

                      <!-- Home & Living -->
                      <div class="p-5 border-r border-base-200">
                        <h4 class="font-semibold text-primary mb-3 text-sm">Home & Living</h4>
                        <div class="flex flex-col gap-0.5">
                          <a href="/services/domestic-assistance" class="block py-1.5 text-base-content/80 hover:text-primary transition-colors text-sm">Domestic Assistance</a>
                          <a href="/services/sil-services" class="block py-1.5 text-base-content/80 hover:text-primary transition-colors text-sm">SIL Services</a>
                          <a href="/services/specialist-disability-accommodation" class="block py-1.5 text-base-content/80 hover:text-primary transition-colors text-sm">Specialist Accommodation</a>
                          <a href="/services/respite-care" class="block py-1.5 text-base-content/80 hover:text-primary transition-colors text-sm">Respite Care</a>
                        </div>
                      </div>

                      <!-- Community & Mobility -->
                      <div class="p-5 border-r border-base-200">
                        <h4 class="font-semibold text-primary mb-3 text-sm whitespace-nowrap">Community & Mobility</h4>
                        <div class="flex flex-col gap-0.5">
                          <a href="/services/community-access-support" class="block py-1.5 text-base-content/80 hover:text-primary transition-colors text-sm">Community Access</a>
                          <a href="/services/transport-services" class="block py-1.5 text-base-content/80 hover:text-primary transition-colors text-sm">Transport Services</a>
                          <a href="/services/disability-home-support-services" class="block py-1.5 text-base-content/80 hover:text-primary transition-colors text-sm">Home Support</a>
                        </div>
                      </div>

                      <!-- Specialized Care -->
                      <div class="p-5">
                        <h4 class="font-semibold text-primary mb-3 text-sm">Specialized Care</h4>
                        <div class="flex flex-col gap-0.5">
                          <a href="/services/therapy-services" class="block py-1.5 text-base-content/80 hover:text-primary transition-colors text-sm">Therapy Services</a>
                          <a href="/services/ndis-specialist-support-coordination" class="block py-1.5 text-base-content/80 hover:text-primary transition-colors text-sm">NDIS Coordination</a>
                          <a href="/services" class="block py-1.5 text-primary font-medium transition-colors text-sm mt-3">
                            All Services →
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </li>

              <li><a href="/blog" class="font-medium hover:text-info">Blog</a></li>
              <li><a href="/jobs" class="font-medium hover:text-info">Jobs</a></li>
              <li><a href="/contact" class="font-medium hover:text-info">Contact</a></li>
            </ul>
          </div>

          <!-- Phone Button (Desktop & Mobile) -->
          <div class="navbar-end gap-2">
            <a href="tel:+61863869999" class="btn btn-info btn-sm lg:btn-md gap-2">
              <Icon name="hugeicons:call-02" class="h-4 w-4" />
              <span class="hidden sm:inline">08 6386 9999</span>
              <span class="sm:hidden">Call</span>
            </a>
          </div>
        </header>

        <!-- Page Content -->
        <main class="flex-1 bg-base-100">
          <slot />
        </main>

        <!-- Footer -->
        <footer class="bg-secondary text-secondary-content mt-16">
          <div class="max-w-7xl mx-auto px-6 py-16">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10">
              <!-- Company Info -->
              <div class="text-center md:text-left">
                <img src="/assets/logo.svg" alt="MD Homecare Logo" class="h-12 w-auto mx-auto md:mx-0 mb-4 drop-shadow-lg" />
                <h3 class="text-xl font-bold text-info mb-3">MD Homecare</h3>
                <p class="text-secondary-content/70 text-sm leading-relaxed mb-6">
                  Providing compassionate and professional home care services to enhance the quality of life for our clients.
                </p>

                <!-- Contact Section -->
                <div class="space-y-3">
                  <h4 class="font-semibold text-info">Contact Us</h4>
                  <a href="tel:+61863869999" class="flex items-center justify-center md:justify-start gap-3 text-secondary-content/70 hover:text-info transition-colors">
                    <span class="w-8 h-8 bg-white/10 rounded-full flex items-center justify-center">
                      <Icon name="hugeicons:call-02" class="h-4 w-4" />
                    </span>
                    <span>08 6386 9999</span>
                  </a>
                  <a href="/contact" class="btn btn-info btn-sm w-full md:w-auto">Message Us</a>
                </div>
              </div>

              <!-- Quick Links -->
              <div>
                <h4 class="font-semibold text-info mb-4">Quick Links</h4>
                <ul class="space-y-3">
                  <li><a href="/" class="text-secondary-content/70 hover:text-info hover:pl-1 transition-all">Home</a></li>
                  <li><a href="/services" class="text-secondary-content/70 hover:text-info hover:pl-1 transition-all">Services</a></li>
                  <li><a href="/blog" class="text-secondary-content/70 hover:text-info hover:pl-1 transition-all">Blog</a></li>
                  <li><a href="/jobs" class="text-secondary-content/70 hover:text-info hover:pl-1 transition-all">Jobs</a></li>
                  <li><a href="/contact" class="text-secondary-content/70 hover:text-info hover:pl-1 transition-all">Contact</a></li>
                </ul>
              </div>

              <!-- Services -->
              <div>
                <h4 class="font-semibold text-info mb-4">Services</h4>
                <ul class="space-y-3">
                  <li><a href="/services/disability-services" class="text-secondary-content/70 hover:text-info hover:pl-1 transition-all text-sm">Disability Services</a></li>
                  <li><a href="/services/personal-care" class="text-secondary-content/70 hover:text-info hover:pl-1 transition-all text-sm">Personal Care</a></li>
                  <li><a href="/services/clinical-care" class="text-secondary-content/70 hover:text-info hover:pl-1 transition-all text-sm">Clinical Care</a></li>
                  <li><a href="/services/support-workers" class="text-secondary-content/70 hover:text-info hover:pl-1 transition-all text-sm">Support Workers</a></li>
                  <li><a href="/services/domestic-assistance" class="text-secondary-content/70 hover:text-info hover:pl-1 transition-all text-sm">Domestic Assistance</a></li>
                  <li><a href="/services/transport-services" class="text-secondary-content/70 hover:text-info hover:pl-1 transition-all text-sm">Transport Services</a></li>
                  <li><a href="/services/respite-care" class="text-secondary-content/70 hover:text-info hover:pl-1 transition-all text-sm">Respite Care</a></li>
                  <li><a href="/services/sil-services" class="text-secondary-content/70 hover:text-info hover:pl-1 transition-all text-sm">SIL Services</a></li>
                  <li>
                    <a href="/services" class="text-info font-medium hover:pl-1 transition-all text-sm inline-flex items-center gap-1">
                      All Services
                      <Icon name="hugeicons:arrow-right-01" class="h-4 w-4" />
                    </a>
                  </li>
                </ul>
              </div>

              <!-- Latest Blog Posts -->
              <div>
                <h4 class="font-semibold text-info mb-4">Latest Blog Posts</h4>
                <ul class="space-y-4">
                  {recentBlogPosts.map(post => (
                    <li>
                      <a href={`/blog/${post.slug}`} class="group block">
                        <span class="text-secondary-content/70 group-hover:text-info transition-colors text-sm font-medium line-clamp-1">{post.data.title}</span>
                        <span class="text-secondary-content/50 text-xs">{formatDate(post.data.pubDate)}</span>
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            </div>

            <!-- Footer Bottom -->
            <div class="border-t border-white/10 mt-12 pt-8 flex flex-col sm:flex-row justify-between items-center gap-4">
              <p class="text-secondary-content/60 text-sm">
                &copy; {new Date().getFullYear()} MD Homecare. All rights reserved.
              </p>
              <div class="flex items-center gap-4 text-sm">
                <a href="/privacy" class="text-secondary-content/60 hover:text-info transition-colors">Privacy Policy</a>
                <span class="text-secondary-content/30">•</span>
                <a href="/terms" class="text-secondary-content/60 hover:text-info transition-colors">Terms of Service</a>
              </div>
            </div>
          </div>
        </footer>
      </div>

      <!-- Mobile Drawer Sidebar -->
      <div class="drawer-side z-[100]">
        <label for="mobile-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
        <div class="bg-secondary text-secondary-content min-h-full w-80 flex flex-col">
          <!-- Header with close button -->
          <div class="flex items-center justify-between p-4 border-b border-white/10">
            <a href="/" class="flex items-center gap-2">
              <img src="/assets/logo.svg" alt="MD Homecare Logo" class="h-8 w-auto" />
              <span class="text-base font-bold text-info">MD Homecare</span>
            </a>
            <label for="mobile-drawer" class="btn btn-ghost btn-sm btn-circle">
              <Icon name="hugeicons:cancel-01" class="h-5 w-5" />
            </label>
          </div>

          <!-- Mobile Navigation Links -->
          <nav class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-1 px-4">
              <li>
                <a href="/" class="block py-3 text-lg font-medium hover:text-info transition-colors">Home</a>
              </li>

              <!-- Services Accordion -->
              <li>
                <details class="group" id="services-details">
                  <summary class="flex items-center justify-between py-3 text-lg font-medium cursor-pointer hover:text-info transition-colors list-none [&::-webkit-details-marker]:hidden">
                    Services
                    <Icon name="hugeicons:arrow-down-01" class="h-5 w-5 transition-transform duration-200 group-open:rotate-180" />
                  </summary>
                  <div class="services-content overflow-hidden transition-all duration-300 ease-out">
                    <div class="mt-2 mb-3 mx-0 bg-base-100 rounded-xl">
                      <div class="p-4 space-y-4">
                      <!-- Personal Support -->
                      <div>
                        <h4 class="text-xs font-semibold text-primary uppercase tracking-wide mb-2">Personal Support</h4>
                        <ul class="space-y-1">
                          <li><a href="/services/disability-services" class="block py-1.5 text-sm text-base-content/70 hover:text-primary transition-colors">Disability Services</a></li>
                          <li><a href="/services/personal-care" class="block py-1.5 text-sm text-base-content/70 hover:text-primary transition-colors">Personal Care</a></li>
                          <li><a href="/services/clinical-care" class="block py-1.5 text-sm text-base-content/70 hover:text-primary transition-colors">Clinical Care</a></li>
                          <li><a href="/services/support-workers" class="block py-1.5 text-sm text-base-content/70 hover:text-primary transition-colors">Support Workers</a></li>
                        </ul>
                      </div>

                      <!-- Home & Living -->
                      <div>
                        <h4 class="text-xs font-semibold text-primary uppercase tracking-wide mb-2">Home & Living</h4>
                        <ul class="space-y-1">
                          <li><a href="/services/domestic-assistance" class="block py-1.5 text-sm text-base-content/70 hover:text-primary transition-colors">Domestic Assistance</a></li>
                          <li><a href="/services/sil-services" class="block py-1.5 text-sm text-base-content/70 hover:text-primary transition-colors">SIL Services</a></li>
                          <li><a href="/services/specialist-disability-accommodation" class="block py-1.5 text-sm text-base-content/70 hover:text-primary transition-colors">Specialist Accommodation</a></li>
                          <li><a href="/services/respite-care" class="block py-1.5 text-sm text-base-content/70 hover:text-primary transition-colors">Respite Care</a></li>
                        </ul>
                      </div>

                      <!-- Community & Mobility -->
                      <div>
                        <h4 class="text-xs font-semibold text-primary uppercase tracking-wide mb-2">Community & Mobility</h4>
                        <ul class="space-y-1">
                          <li><a href="/services/community-access-support" class="block py-1.5 text-sm text-base-content/70 hover:text-primary transition-colors">Community Access</a></li>
                          <li><a href="/services/transport-services" class="block py-1.5 text-sm text-base-content/70 hover:text-primary transition-colors">Transport Services</a></li>
                          <li><a href="/services/disability-home-support-services" class="block py-1.5 text-sm text-base-content/70 hover:text-primary transition-colors">Home Support</a></li>
                        </ul>
                      </div>

                      <!-- Specialized Care -->
                      <div>
                        <h4 class="text-xs font-semibold text-primary uppercase tracking-wide mb-2">Specialized Care</h4>
                        <ul class="space-y-1">
                          <li><a href="/services/therapy-services" class="block py-1.5 text-sm text-base-content/70 hover:text-primary transition-colors">Therapy Services</a></li>
                          <li><a href="/services/ndis-specialist-support-coordination" class="block py-1.5 text-sm text-base-content/70 hover:text-primary transition-colors">NDIS Support Coordination</a></li>
                        </ul>
                      </div>

                      <!-- All Services Link -->
                      <a href="/services" class="block py-2 text-sm font-medium text-primary hover:underline">
                        View All Services →
                      </a>
                      </div>
                    </div>
                  </div>
                </details>
              </li>

              <li>
                <a href="/blog" class="block py-3 text-lg font-medium hover:text-info transition-colors">Blog</a>
              </li>
              <li>
                <a href="/jobs" class="block py-3 text-lg font-medium hover:text-info transition-colors">Jobs</a>
              </li>
              <li>
                <a href="/contact" class="block py-3 text-lg font-medium hover:text-info transition-colors">Contact</a>
              </li>
            </ul>
          </nav>

          <!-- Mobile Phone Link -->
          <div class="p-4 border-t border-white/10">
            <a href="tel:+61863869999" class="btn btn-info btn-block gap-2">
              <Icon name="hugeicons:call-02" class="h-5 w-5" />
              Call 08 6386 9999
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Smooth accordion animation script -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const details = document.getElementById('services-details');
        if (!details) return;

        const content = details.querySelector('.services-content');
        if (!content) return;

        // Set initial state
        if (!details.open) {
          content.style.maxHeight = '0px';
          content.style.opacity = '0';
        } else {
          content.style.maxHeight = content.scrollHeight + 'px';
          content.style.opacity = '1';
        }

        details.addEventListener('toggle', () => {
          if (details.open) {
            // Opening
            content.style.maxHeight = content.scrollHeight + 'px';
            content.style.opacity = '1';
          } else {
            // Closing
            content.style.maxHeight = '0px';
            content.style.opacity = '0';
          }
        });

        // Handle click to animate before native toggle
        const summary = details.querySelector('summary');
        if (summary) {
          summary.addEventListener('click', (e) => {
            e.preventDefault();

            if (details.open) {
              // Animate close first, then close
              content.style.maxHeight = '0px';
              content.style.opacity = '0';
              setTimeout(() => {
                details.open = false;
              }, 300);
            } else {
              // Open first, then animate
              details.open = true;
              requestAnimationFrame(() => {
                content.style.maxHeight = content.scrollHeight + 'px';
                content.style.opacity = '1';
              });
            }
          });
        }
      });
    </script>
  </body>
</html>
