---
// Import global styles (Tailwind CSS 4 + DaisyUI 5)
import '../styles/global.css';
import { Icon } from 'astro-icon/components';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

// Define the props interface
interface Props {
  title: string;
  description?: string;
  image?: string;
  canonical?: string;
  noindex?: boolean;
  nofollow?: boolean;
  metaTitle?: string;
  metaDescription?: string;
}

// Destructure props with defaults
const {
  title: rawTitle,
  description = "Providing compassionate and professional home care services",
  image = "/images/default-social.jpg",
  canonical = Astro.url.href,
  noindex = false,
  nofollow = false,
  metaTitle,
  metaDescription
} = Astro.props;

// Smart title construction - add brand suffix if not already present and title is short enough
const brandSuffix = " | MD Home Care";
const title = rawTitle.includes("MD Home Care") || rawTitle.includes("MD Homecare")
  ? rawTitle
  : rawTitle.length + brandSuffix.length <= 65
    ? rawTitle + brandSuffix
    : rawTitle;

import { SEO } from 'astro-seo';
// Import PostHog component
import PostHog from '../components/posthog.astro';

// Generate JSON-LD structured data for organization
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "@id": "https://mdhomecare.com.au/#organization",
  "name": "MD Home Care",
  "url": "https://mdhomecare.com.au",
  "logo": "https://mdhomecare.com.au/assets/logo.svg",
  "image": "https://mdhomecare.com.au/assets/logo.svg",
  "description": "NDIS and aged care connection platform across Sydney, Melbourne, and regional Australia. Connecting you with qualified providers for disability and aged care services.",
  "telephone": "+61863869999",
  "email": "contact@mdhomecare.com.au",
  "priceRange": "$$",
  "currenciesAccepted": "AUD",
  "paymentAccepted": "NDIS, Cash, Bank Transfer",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "6/11 York St",
    "addressLocality": "Sydney",
    "addressRegion": "NSW",
    "postalCode": "2000",
    "addressCountry": "AU"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": "-33.8688",
    "longitude": "151.2093"
  },
  // Service areas - critical for "near me" rankings
  "areaServed": [
    // Major Sydney areas
    { "@type": "City", "name": "Sydney", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Parramatta", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Liverpool", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Blacktown", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Bankstown", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Campbelltown", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Penrith", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Fairfield", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Hornsby", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Ryde", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Burwood", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Bondi", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Randwick", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Hurstville", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Sutherland", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Chatswood", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Auburn", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Merrylands", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    // Major Melbourne areas
    { "@type": "City", "name": "Melbourne", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Dandenong", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Frankston", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Geelong", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Brunswick", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Footscray", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    // Regional areas
    { "@type": "City", "name": "Newcastle", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Wollongong", "containedInPlace": { "@type": "State", "name": "New South Wales" }},
    { "@type": "City", "name": "Canberra", "containedInPlace": { "@type": "State", "name": "Australian Capital Territory" }},
    { "@type": "City", "name": "Brisbane", "containedInPlace": { "@type": "State", "name": "Queensland" }},
    { "@type": "City", "name": "Perth", "containedInPlace": { "@type": "State", "name": "Western Australia" }},
    { "@type": "City", "name": "Adelaide", "containedInPlace": { "@type": "State", "name": "South Australia" }}
  ],
  "openingHoursSpecification": {
    "@type": "OpeningHoursSpecification",
    "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
    "opens": "00:00",
    "closes": "23:59"
  },
  "sameAs": [
    "https://www.facebook.com/mdhomecare",
    "https://www.instagram.com/mdhomecare"
  ],
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.8",
    "reviewCount": "127",
    "bestRating": "5",
    "worstRating": "1"
  },
  "review": [
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Sarah Thompson"
      },
      "datePublished": "2023-10-15",
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "MD Homecare's support workers have been amazing for my daughter. They're incredibly patient, caring, and reliable. I couldn't ask for better NDIS support."
    },
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Michael Johnson"
      },
      "datePublished": "2023-09-22",
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "The team at MD Homecare has made such a difference in my life. Their in-home disability support services are personalized and professional."
    },
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Emma Wilson"
      },
      "datePublished": "2023-11-08",
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "4",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "Very satisfied with the domestic assistance services. The support workers are always on time and do a thorough job."
    }
  ]
};

// Melbourne LocalBusiness entity for city-specific rankings
const melbourneBusinessSchema = {
  "@type": "LocalBusiness",
  "@id": "https://mdhomecare.com.au/#organization-melbourne",
  "name": "MD Home Care Melbourne",
  "url": "https://mdhomecare.com.au",
  "logo": "https://mdhomecare.com.au/assets/logo.svg",
  "description": "NDIS and aged care connection platform across Melbourne and regional Victoria. Connecting you with qualified providers for disability and aged care services.",
  "telephone": "+61863869999",
  "email": "contact@mdhomecare.com.au",
  "priceRange": "$$",
  "currenciesAccepted": "AUD",
  "paymentAccepted": "NDIS, Cash, Bank Transfer",
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Melbourne",
    "addressRegion": "VIC",
    "addressCountry": "AU"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": "-37.8136",
    "longitude": "144.9631"
  },
  "areaServed": [
    { "@type": "City", "name": "Melbourne", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Dandenong", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Frankston", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Geelong", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Brunswick", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Footscray", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Richmond", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "St Kilda", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Werribee", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Ballarat", "containedInPlace": { "@type": "State", "name": "Victoria" }},
    { "@type": "City", "name": "Bendigo", "containedInPlace": { "@type": "State", "name": "Victoria" }}
  ],
  "openingHoursSpecification": {
    "@type": "OpeningHoursSpecification",
    "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
    "opens": "00:00",
    "closes": "23:59"
  },
  "sameAs": [
    "https://www.facebook.com/mdhomecare",
    "https://www.instagram.com/mdhomecare"
  ],
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.8",
    "reviewCount": "127",
    "bestRating": "5",
    "worstRating": "1"
  }
};

// Combine both Sydney and Melbourne entities in a @graph
const organizationSchemaGraph = {
  "@context": "https://schema.org",
  "@graph": [organizationSchema, melbourneBusinessSchema]
};

const structuredDataOrg = JSON.stringify(organizationSchemaGraph);
---

<!DOCTYPE html>
<html lang="en" data-theme="mdhomecare">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content={Astro.generator}>

    <SEO
      title={metaTitle || title}
      description={metaDescription || description}
      canonical={canonical}
      openGraph={{
        basic: {
          title: metaTitle || title,
          type: "website",
          image: image,
          url: Astro.url,
        },
        optional: {
          description: metaDescription || description,
          locale: "en_AU",
          siteName: "MD Homecare",
        },
        image: {
          alt: "MD Homecare website image",
        },
        article: {
          publishedTime: new Date().toISOString(),
          tags: ["homecare", "NDIS", "disability", "support"],
        },
      }}
      twitter={{
        card: "summary_large_image",
        title: title,
        description: description,
        image: image,
        imageAlt: "MD Homecare website image",
        site: "@mdhomecare",
        creator: "@mdhomecare",
      }}
      extend={{
        link: [
          { rel: "icon", type: "image/svg+xml", href: "/favicon.svg" },
          { rel: "apple-touch-icon", href: "/apple-touch-icon.png" },
          { rel: "manifest", href: "/manifest.json" },
        ],
        meta: [
          { name: "generator", content: Astro.generator },
          { name: "robots", content: noindex ? "noindex" : "index,follow" },
          { name: "robots", content: nofollow ? "nofollow" : undefined },
          { name: "theme-color", content: "#0f172a" },
          { name: "apple-mobile-web-app-capable", content: "yes" },
          { name: "apple-mobile-web-app-status-bar-style", content: "black-translucent" },
          { name: "author", content: "MD Homecare" },
        ],
      }}
    />

    <!-- Organization LocalBusiness Structured Data -->
    <script type="application/ld+json" set:html={structuredDataOrg} />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-05DBKL39SX"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-05DBKL39SX');
    </script>

    <!-- PostHog Analytics -->
    <PostHog />
  </head>
  <body class="min-h-screen bg-base-100 selection:bg-primary/20 selection:text-primary">
    
    <!-- DaisyUI Navbar with Drawer for Mobile -->
    <div class="drawer drawer-end">
      <input id="mobile-drawer" type="checkbox" class="drawer-toggle" />

      <div class="drawer-content flex flex-col min-h-screen">
        <Header />
        
        <!-- Page Content -->
        <main class="flex-1 w-full">
          <slot />
        </main>

        <Footer />
      </div>

      <!-- Mobile Drawer Sidebar -->
      <div class="drawer-side z-[100]">
        <label for="mobile-drawer" aria-label="close sidebar" class="drawer-overlay backdrop-blur-sm bg-black/20"></label>
        <div class="bg-secondary text-secondary-content min-h-full w-80 p-6 flex flex-col gap-6 shadow-2xl">
          
          <!-- Header with close button -->
          <div class="flex items-center justify-between border-b border-white/10 pb-6">
            <a href="/" class="flex items-center gap-2">
              <img src="/assets/logo.svg" alt="MD Homecare Logo" class="h-8 w-auto" />
              <span class="text-base font-bold text-white">MD Homecare</span>
            </a>
            <label for="mobile-drawer" class="btn btn-ghost btn-sm btn-circle text-white/50 hover:text-white hover:bg-white/10">
              <Icon name="hugeicons:cancel-01" class="h-6 w-6" />
            </label>
          </div>

          <!-- Mobile Navigation Links -->
          <nav class="flex-1 overflow-y-auto">
            <ul class="flex flex-col gap-2">
              <li>
                <a href="/" class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 transition-colors text-lg font-medium text-white">Home</a>
              </li>

              <!-- Services Accordion -->
              <li>
                <details class="group" id="services-details">
                  <summary class="flex items-center justify-between px-4 py-3 rounded-xl hover:bg-white/10 transition-colors text-lg font-medium text-white cursor-pointer list-none [&::-webkit-details-marker]:hidden">
                    Services
                    <Icon name="hugeicons:arrow-down-01" class="h-5 w-5 transition-transform duration-200 group-open:rotate-180 opacity-50" />
                  </summary>
                  
                  <div class="services-content overflow-hidden transition-all duration-300 ease-out pl-4">
                    <div class="border-l-2 border-white/10 pl-4 py-2 space-y-6 mt-2">
                      
                      <!-- Personal Support -->
                      <div>
                        <h4 class="text-xs font-bold text-primary uppercase tracking-wider mb-3">Personal Support</h4>
                        <ul class="space-y-2">
                          <li><a href="/services/disability-services" class="block text-base text-secondary-content/70 hover:text-white transition-colors">Disability Services</a></li>
                          <li><a href="/services/personal-care" class="block text-base text-secondary-content/70 hover:text-white transition-colors">Personal Care</a></li>
                          <li><a href="/services/clinical-care" class="block text-base text-secondary-content/70 hover:text-white transition-colors">Clinical Care</a></li>
                          <li><a href="/services/support-workers" class="block text-base text-secondary-content/70 hover:text-white transition-colors">Support Workers</a></li>
                        </ul>
                      </div>

                      <!-- Home & Living -->
                      <div>
                        <h4 class="text-xs font-bold text-primary uppercase tracking-wider mb-3">Home & Living</h4>
                        <ul class="space-y-2">
                          <li><a href="/services/domestic-assistance" class="block text-base text-secondary-content/70 hover:text-white transition-colors">Domestic Assistance</a></li>
                          <li><a href="/services/sil-services" class="block text-base text-secondary-content/70 hover:text-white transition-colors">SIL Services</a></li>
                          <li><a href="/services/respite-care" class="block text-base text-secondary-content/70 hover:text-white transition-colors">Respite Care</a></li>
                        </ul>
                      </div>

                      <!-- All Services Link -->
                      <a href="/services" class="inline-flex items-center gap-2 text-sm font-bold text-primary hover:underline pt-2">
                        View All Services
                        <Icon name="hugeicons:arrow-right-01" class="h-4 w-4" />
                      </a>

                    </div>
                  </div>
                </details>
              </li>

              <li>
                <a href="/blog" class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 transition-colors text-lg font-medium text-white">Blog</a>
              </li>
              <li>
                <a href="/jobs" class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 transition-colors text-lg font-medium text-white">Jobs</a>
              </li>
              <li>
                <a href="/contact" class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 transition-colors text-lg font-medium text-white">Contact</a>
              </li>
            </ul>
          </nav>

          <!-- Mobile Phone Link -->
          <div class="pt-6 border-t border-white/10">
            <a href="tel:+61863869999" class="btn btn-primary w-full rounded-full gap-2 font-bold shadow-lg shadow-primary/20">
              <Icon name="hugeicons:call-02" class="h-5 w-5" />
              Call 08 6386 9999
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Smooth accordion animation script -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const details = document.getElementById('services-details') as HTMLDetailsElement;
        if (!details) return;

        const content = details.querySelector('.services-content') as HTMLElement;
        if (!content) return;

        // Set initial state
        if (!details.open) {
          content.style.maxHeight = '0px';
          content.style.opacity = '0';
        } else {
          content.style.maxHeight = content.scrollHeight + 'px';
          content.style.opacity = '1';
        }

        details.addEventListener('toggle', () => {
          if (details.open) {
            // Opening
            content.style.maxHeight = content.scrollHeight + 'px';
            content.style.opacity = '1';
          } else {
            // Closing
            content.style.maxHeight = '0px';
            content.style.opacity = '0';
          }
        });

        // Handle click to animate before native toggle
        const summary = details.querySelector('summary');
        if (summary) {
          summary.addEventListener('click', (e) => {
            e.preventDefault();

            if (details.open) {
              // Animate close first, then close
              content.style.maxHeight = '0px';
              content.style.opacity = '0';
              setTimeout(() => {
                details.open = false;
              }, 300);
            } else {
              // Open first, then animate
              details.open = true;
              requestAnimationFrame(() => {
                content.style.maxHeight = content.scrollHeight + 'px';
                content.style.opacity = '1';
              });
            }
          });
        }
      });
    </script>
  </body>
</html>
