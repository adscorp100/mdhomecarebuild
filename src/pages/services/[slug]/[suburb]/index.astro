---
import { getCollection } from 'astro:content';
import BaseLayout from '../../../../layouts/BaseLayout.astro';
import EligibilityChecker from '../../../../components/EligibilityChecker.astro';
import QuickFacts from '../../../../components/QuickFacts.astro';
import regionContent from '../../../../data/region-content.json';
import suburbDetails from '../../../../data/suburb-details.json';
import { getNearbySuburbs, getRelatedBlogPosts, getCleanServiceName } from '../../../../utils/internalLinks';

// Type definitions
interface SuburbInfo {
  state: string;
  region: string;
}

interface SuburbData {
  [key: string]: SuburbInfo;
}

interface RegionContentData {
  [key: string]: {
    localInsight: string;
    nearbyHospitals: string[];
    transportNote: string;
    ndisOffice?: string;
    populationNote?: string;
  };
}

interface SuburbDetailsData {
  [key: string]: {
    displayName?: string;
    population?: string;
    elderlyPercent?: string;
    ndisParticipants?: string;
    localCouncil?: string;
    nearestHospital?: string;
    postcode?: string;
  };
}

// Generate static paths for all service/suburb combinations
export async function getStaticPaths() {
  // Hardcoded suburbs data
  const suburbsData: SuburbData = {
    // Greater Sydney
    "sydney": { "state": "NSW", "region": "Greater Sydney" },
    "cbd": { "state": "NSW", "region": "Greater Sydney" },
    "haymarket": { "state": "NSW", "region": "Greater Sydney" },
    "the-rocks": { "state": "NSW", "region": "Greater Sydney" },
    "barangaroo": { "state": "NSW", "region": "Greater Sydney" },
    "pyrmont": { "state": "NSW", "region": "Greater Sydney" },
    "ultimo": { "state": "NSW", "region": "Greater Sydney" },
    "chippendale": { "state": "NSW", "region": "Greater Sydney" },
    "surry-hills": { "state": "NSW", "region": "Greater Sydney" },
    "darlinghurst": { "state": "NSW", "region": "Greater Sydney" },
    "potts-point": { "state": "NSW", "region": "Greater Sydney" },
    "elizabeth-bay": { "state": "NSW", "region": "Greater Sydney" },
    "rushcutters-bay": { "state": "NSW", "region": "Greater Sydney" },
    "woolloomooloo": { "state": "NSW", "region": "Greater Sydney" },
    "redfern": { "state": "NSW", "region": "Greater Sydney" },
    "waterloo": { "state": "NSW", "region": "Greater Sydney" },
    "zetland": { "state": "NSW", "region": "Greater Sydney" },
    "alexandria": { "state": "NSW", "region": "Greater Sydney" },
    "erskineville": { "state": "NSW", "region": "Greater Sydney" },

    // Eastern Suburbs
    "bondi": { "state": "NSW", "region": "Eastern Suburbs" },
    "bondi-beach": { "state": "NSW", "region": "Eastern Suburbs" },
    "bondi-junction": { "state": "NSW", "region": "Eastern Suburbs" },
    "bronte": { "state": "NSW", "region": "Eastern Suburbs" },
    "clovelly": { "state": "NSW", "region": "Eastern Suburbs" },
    "coogee": { "state": "NSW", "region": "Eastern Suburbs" },
    "maroubra": { "state": "NSW", "region": "Eastern Suburbs" },
    "kensington": { "state": "NSW", "region": "Eastern Suburbs" },
    "randwick": { "state": "NSW", "region": "Eastern Suburbs" },
    "vaucluse": { "state": "NSW", "region": "Eastern Suburbs" },
    "rose-bay": { "state": "NSW", "region": "Eastern Suburbs" },
    "double-bay": { "state": "NSW", "region": "Eastern Suburbs" },
    "bellevue-hill": { "state": "NSW", "region": "Eastern Suburbs" },
    "dover-heights": { "state": "NSW", "region": "Eastern Suburbs" },
    "queens-park": { "state": "NSW", "region": "Eastern Suburbs" },
    "pagewood": { "state": "NSW", "region": "Eastern Suburbs" },
    "eastgardens": { "state": "NSW", "region": "Eastern Suburbs" },
    "little-bay": { "state": "NSW", "region": "Eastern Suburbs" },
    "la-perouse": { "state": "NSW", "region": "Eastern Suburbs" },

    // Inner West
    "burwood": { "state": "NSW", "region": "Inner West" },
    "strathfield": { "state": "NSW", "region": "Inner West" },
    "newtown": { "state": "NSW", "region": "Inner West" },
    "marrickville": { "state": "NSW", "region": "Inner West" },
    "dulwich-hill": { "state": "NSW", "region": "Inner West" },
    "summer-hill": { "state": "NSW", "region": "Inner West" },
    "ashfield": { "state": "NSW", "region": "Inner West" },
    "leichhardt": { "state": "NSW", "region": "Inner West" },
    "balmain": { "state": "NSW", "region": "Inner West" },
    "rozelle": { "state": "NSW", "region": "Inner West" },
    "lilyfield": { "state": "NSW", "region": "Inner West" },
    "annandale": { "state": "NSW", "region": "Inner West" },
    "petersham": { "state": "NSW", "region": "Inner West" },
    "stanmore": { "state": "NSW", "region": "Inner West" },
    "enmore": { "state": "NSW", "region": "Inner West" },
    "croydon": { "state": "NSW", "region": "Inner West" },
    "croydon-park": { "state": "NSW", "region": "Inner West" },
    "haberfield": { "state": "NSW", "region": "Inner West" },
    "five-dock": { "state": "NSW", "region": "Inner West" },
    "drummoyne": { "state": "NSW", "region": "Inner West" },
    "glebe": { "state": "NSW", "region": "Inner West" },

    // North Shore
    "chatswood": { "state": "NSW", "region": "North Shore" },
    "st-leonards": { "state": "NSW", "region": "North Shore" },
    "artarmon": { "state": "NSW", "region": "Lower North Shore" },
    "willoughby": { "state": "NSW", "region": "Lower North Shore" },
    "naremburn": { "state": "NSW", "region": "Lower North Shore" },
    "northbridge": { "state": "NSW", "region": "Lower North Shore" },
    "cammeray": { "state": "NSW", "region": "Lower North Shore" },
    "cremorne": { "state": "NSW", "region": "Lower North Shore" },
    "neutral-bay": { "state": "NSW", "region": "Lower North Shore" },
    "mosman": { "state": "NSW", "region": "Lower North Shore" },
    "north-sydney": { "state": "NSW", "region": "Lower North Shore" },
    "kirribilli": { "state": "NSW", "region": "Lower North Shore" },
    "lavender-bay": { "state": "NSW", "region": "Lower North Shore" },
    "wollstonecraft": { "state": "NSW", "region": "Lower North Shore" },
    "greenwich": { "state": "NSW", "region": "Lower North Shore" },
    "lane-cove": { "state": "NSW", "region": "Lower North Shore" },
    "riverview": { "state": "NSW", "region": "Lower North Shore" },
    "longueville": { "state": "NSW", "region": "Lower North Shore" },

    // Upper North Shore
    "gordon": { "state": "NSW", "region": "Upper North Shore" },
    "killara": { "state": "NSW", "region": "Upper North Shore" },
    "lindfield": { "state": "NSW", "region": "Upper North Shore" },
    "roseville": { "state": "NSW", "region": "Upper North Shore" },
    "pymble": { "state": "NSW", "region": "Upper North Shore" },
    "turramurra": { "state": "NSW", "region": "Upper North Shore" },
    "wahroonga": { "state": "NSW", "region": "Upper North Shore" },
    "warrawee": { "state": "NSW", "region": "Upper North Shore" },
    "st-ives": { "state": "NSW", "region": "Upper North Shore" },
    "hornsby": { "state": "NSW", "region": "Upper North Shore" },
    "waitara": { "state": "NSW", "region": "Upper North Shore" },
    "asquith": { "state": "NSW", "region": "Upper North Shore" },
    "berowra": { "state": "NSW", "region": "Upper North Shore" },

    // Northern Suburbs
    "ryde": { "state": "NSW", "region": "Northern Sydney" },
    "eastwood": { "state": "NSW", "region": "Northern Sydney" },
    "epping": { "state": "NSW", "region": "Northern Sydney" },
    "macquarie-park": { "state": "NSW", "region": "Northern Sydney" },
    "north-ryde": { "state": "NSW", "region": "Northern Sydney" },
    "marsfield": { "state": "NSW", "region": "Northern Sydney" },
    "west-ryde": { "state": "NSW", "region": "Northern Sydney" },
    "meadowbank": { "state": "NSW", "region": "Northern Sydney" },
    "denistone": { "state": "NSW", "region": "Northern Sydney" },
    "putney": { "state": "NSW", "region": "Northern Sydney" },
    "gladesville": { "state": "NSW", "region": "Northern Sydney" },
    "hunters-hill": { "state": "NSW", "region": "Northern Sydney" },

    // Northern Beaches
    "manly": { "state": "NSW", "region": "Northern Beaches" },
    "dee-why": { "state": "NSW", "region": "Northern Beaches" },
    "brookvale": { "state": "NSW", "region": "Northern Beaches" },
    "freshwater": { "state": "NSW", "region": "Northern Beaches" },
    "curl-curl": { "state": "NSW", "region": "Northern Beaches" },
    "queenscliff": { "state": "NSW", "region": "Northern Beaches" },
    "fairlight": { "state": "NSW", "region": "Northern Beaches" },
    "balgowlah": { "state": "NSW", "region": "Northern Beaches" },
    "seaforth": { "state": "NSW", "region": "Northern Beaches" },
    "narrabeen": { "state": "NSW", "region": "Northern Beaches" },
    "collaroy": { "state": "NSW", "region": "Northern Beaches" },
    "avalon": { "state": "NSW", "region": "Northern Beaches" },
    "newport": { "state": "NSW", "region": "Northern Beaches" },
    "mona-vale": { "state": "NSW", "region": "Northern Beaches" },
    "palm-beach": { "state": "NSW", "region": "Northern Beaches" },

    // Hills District
    "castle-hill": { "state": "NSW", "region": "Hills District" },
    "baulkham-hills": { "state": "NSW", "region": "Hills District" },
    "bella-vista": { "state": "NSW", "region": "Hills District" },
    "kellyville": { "state": "NSW", "region": "Hills District" },
    "rouse-hill": { "state": "NSW", "region": "Hills District" },
    "pennant-hills": { "state": "NSW", "region": "Hills District" },
    "cherrybrook": { "state": "NSW", "region": "Hills District" },
    "west-pennant-hills": { "state": "NSW", "region": "Hills District" },
    "northmead": { "state": "NSW", "region": "Hills District" },
    "winston-hills": { "state": "NSW", "region": "Hills District" },
    "north-rocks": { "state": "NSW", "region": "Hills District" },
    "carlingford": { "state": "NSW", "region": "Hills District" },

    // Western Sydney
    "parramatta": { "state": "NSW", "region": "Western Sydney" },
    "penrith": { "state": "NSW", "region": "Western Sydney" },
    "blacktown": { "state": "NSW", "region": "Western Sydney" },
    "westmead": { "state": "NSW", "region": "Western Sydney" },
    "wentworthville": { "state": "NSW", "region": "Western Sydney" },
    "toongabbie": { "state": "NSW", "region": "Western Sydney" },
    "seven-hills": { "state": "NSW", "region": "Western Sydney" },
    "kings-langley": { "state": "NSW", "region": "Western Sydney" },
    "kings-park": { "state": "NSW", "region": "Western Sydney" },
    "prospect": { "state": "NSW", "region": "Western Sydney" },
    "girraween": { "state": "NSW", "region": "Western Sydney" },
    "pemulwuy": { "state": "NSW", "region": "Western Sydney" },
    "greystanes": { "state": "NSW", "region": "Western Sydney" },
    "merrylands": { "state": "NSW", "region": "Western Sydney" },
    "guildford": { "state": "NSW", "region": "Western Sydney" },
    "auburn": { "state": "NSW", "region": "Western Sydney" },
    "granville": { "state": "NSW", "region": "Western Sydney" },
    "harris-park": { "state": "NSW", "region": "Western Sydney" },
    "st-marys": { "state": "NSW", "region": "Western Sydney" },
    "mount-druitt": { "state": "NSW", "region": "Western Sydney" },
    "rooty-hill": { "state": "NSW", "region": "Western Sydney" },
    "doonside": { "state": "NSW", "region": "Western Sydney" },
    "quakers-hill": { "state": "NSW", "region": "Western Sydney" },

    // South Western Sydney
    "liverpool": { "state": "NSW", "region": "South Western Sydney" },
    "fairfield": { "state": "NSW", "region": "South Western Sydney" },
    "cabramatta": { "state": "NSW", "region": "South Western Sydney" },
    "bankstown": { "state": "NSW", "region": "South Western Sydney" },
    "revesby": { "state": "NSW", "region": "South Western Sydney" },
    "padstow": { "state": "NSW", "region": "South Western Sydney" },
    "punchbowl": { "state": "NSW", "region": "South Western Sydney" },
    "yagoona": { "state": "NSW", "region": "South Western Sydney" },
    "bass-hill": { "state": "NSW", "region": "South Western Sydney" },
    "chester-hill": { "state": "NSW", "region": "South Western Sydney" },
    "sefton": { "state": "NSW", "region": "South Western Sydney" },
    "birrong": { "state": "NSW", "region": "South Western Sydney" },
    "regents-park": { "state": "NSW", "region": "South Western Sydney" },
    "berala": { "state": "NSW", "region": "South Western Sydney" },
    "lidcombe": { "state": "NSW", "region": "South Western Sydney" },
    "condell-park": { "state": "NSW", "region": "South Western Sydney" },
    "greenacre": { "state": "NSW", "region": "South Western Sydney" },
    "chullora": { "state": "NSW", "region": "South Western Sydney" },
    "villawood": { "state": "NSW", "region": "South Western Sydney" },
    "canley-vale": { "state": "NSW", "region": "South Western Sydney" },
    "canley-heights": { "state": "NSW", "region": "South Western Sydney" },
    "warwick-farm": { "state": "NSW", "region": "South Western Sydney" },
    "casula": { "state": "NSW", "region": "South Western Sydney" },
    "prestons": { "state": "NSW", "region": "South Western Sydney" },
    "hoxton-park": { "state": "NSW", "region": "South Western Sydney" },
    "west-hoxton": { "state": "NSW", "region": "South Western Sydney" },
    "middleton-grange": { "state": "NSW", "region": "South Western Sydney" },

    // St George
    "hurstville": { "state": "NSW", "region": "St George" },
    "kogarah": { "state": "NSW", "region": "St George" },
    "rockdale": { "state": "NSW", "region": "St George" },
    "brighton-le-sands": { "state": "NSW", "region": "St George" },
    "sans-souci": { "state": "NSW", "region": "St George" },
    "ramsgate": { "state": "NSW", "region": "St George" },
    "monterey": { "state": "NSW", "region": "St George" },
    "dolls-point": { "state": "NSW", "region": "St George" },
    "sandringham": { "state": "NSW", "region": "St George" },
    "beverly-hills": { "state": "NSW", "region": "St George" },
    "kingsgrove": { "state": "NSW", "region": "St George" },
    "bexley": { "state": "NSW", "region": "St George" },
    "carlton": { "state": "NSW", "region": "St George" },
    "allawah": { "state": "NSW", "region": "St George" },
    "mortdale": { "state": "NSW", "region": "St George" },
    "penshurst": { "state": "NSW", "region": "St George" },
    "oatley": { "state": "NSW", "region": "St George" },

    // Sutherland Shire
    "cronulla": { "state": "NSW", "region": "Sutherland Shire" },
    "sutherland": { "state": "NSW", "region": "Sutherland Shire" },
    "miranda": { "state": "NSW", "region": "Sutherland Shire" },
    "caringbah": { "state": "NSW", "region": "Sutherland Shire" },
    "gymea": { "state": "NSW", "region": "Sutherland Shire" },
    "engadine": { "state": "NSW", "region": "Sutherland Shire" },
    "sylvania": { "state": "NSW", "region": "Sutherland Shire" },
    "jannali": { "state": "NSW", "region": "Sutherland Shire" },
    "como": { "state": "NSW", "region": "Sutherland Shire" },
    "oyster-bay": { "state": "NSW", "region": "Sutherland Shire" },
    "woolooware": { "state": "NSW", "region": "Sutherland Shire" },
    "loftus": { "state": "NSW", "region": "Sutherland Shire" },
    "yarrawarrah": { "state": "NSW", "region": "Sutherland Shire" },
    "grays-point": { "state": "NSW", "region": "Sutherland Shire" },
    "kirrawee": { "state": "NSW", "region": "Sutherland Shire" },
    "kareela": { "state": "NSW", "region": "Sutherland Shire" },
    "yowie-bay": { "state": "NSW", "region": "Sutherland Shire" },
    "lilli-pilli": { "state": "NSW", "region": "Sutherland Shire" },
    "port-hacking": { "state": "NSW", "region": "Sutherland Shire" },

    // Rest of Australia
    "newcastle": { "state": "NSW", "region": "Hunter Region" },
    "wollongong": { "state": "NSW", "region": "Illawarra" },
    "gosford": { "state": "NSW", "region": "Central Coast" },
    "bathurst": { "state": "NSW", "region": "Central West" },
    "tamworth": { "state": "NSW", "region": "New England" },
    "dubbo": { "state": "NSW", "region": "Central West" },
    "byron-bay": { "state": "NSW", "region": "Northern Rivers" },
    "canberra": { "state": "ACT", "region": "Canberra" },
    "belconnen": { "state": "ACT", "region": "Canberra" },
    "woden": { "state": "ACT", "region": "Canberra" },
    "tuggeranong": { "state": "ACT", "region": "Canberra" },
    "gungahlin": { "state": "ACT", "region": "Canberra" },
    "queanbeyan": { "state": "NSW", "region": "Capital Region" },

    // Victoria
    "melbourne": { "state": "VIC", "region": "Greater Melbourne" },
    "brunswick": { "state": "VIC", "region": "Melbourne Northern" },
    "footscray": { "state": "VIC", "region": "Melbourne Western" },
    "brighton": { "state": "VIC", "region": "Melbourne South Eastern" },
    "geelong": { "state": "VIC", "region": "Regional Victoria" },
    "ballarat": { "state": "VIC", "region": "Regional Victoria" },
    "bendigo": { "state": "VIC", "region": "Regional Victoria" },
    "frankston": { "state": "VIC", "region": "Mornington Peninsula" },
    "st-kilda": { "state": "VIC", "region": "Melbourne Inner" },
    "richmond": { "state": "VIC", "region": "Melbourne Inner" },
    "dandenong": { "state": "VIC", "region": "Melbourne South Eastern" },
    "werribee": { "state": "VIC", "region": "Melbourne Western" },
    "toorak": { "state": "VIC", "region": "Melbourne Eastern" },
    "mildura": { "state": "VIC", "region": "Regional Victoria" },

    // Queensland
    "brisbane": { "state": "QLD", "region": "Greater Brisbane" },
    "gold-coast": { "state": "QLD", "region": "Gold Coast" },
    "sunshine-coast": { "state": "QLD", "region": "Sunshine Coast" },
    "cairns": { "state": "QLD", "region": "Regional Queensland" },
    "townsville": { "state": "QLD", "region": "Regional Queensland" },
    "toowoomba": { "state": "QLD", "region": "Regional Queensland" },
    "mackay": { "state": "QLD", "region": "Regional Queensland" },
    "rockhampton": { "state": "QLD", "region": "Regional Queensland" },
    "bundaberg": { "state": "QLD", "region": "Regional Queensland" },
    "hervey-bay": { "state": "QLD", "region": "Regional Queensland" },
    "southport": { "state": "QLD", "region": "Gold Coast" },
    "west-end": { "state": "QLD", "region": "Brisbane Inner" },
    "fortitude-valley": { "state": "QLD", "region": "Brisbane Inner" },

    // Western Australia
    "perth": { "state": "WA", "region": "Greater Perth" },
    "fremantle": { "state": "WA", "region": "Greater Perth" },
    "joondalup": { "state": "WA", "region": "Perth Northern" },
    "mandurah": { "state": "WA", "region": "Greater Perth" },
    "bunbury": { "state": "WA", "region": "Greater Perth" },
    "geraldton": { "state": "WA", "region": "Greater Perth" },
    "kalgoorlie": { "state": "WA", "region": "Greater Perth" },
    "broome": { "state": "WA", "region": "Greater Perth" },
    "scarborough": { "state": "WA", "region": "Perth Inner" },
    "subiaco": { "state": "WA", "region": "Perth Inner" },

    // South Australia
    "adelaide": { "state": "SA", "region": "Greater Adelaide" },
    "glenelg": { "state": "SA", "region": "Greater Adelaide" },
    "mount-gambier": { "state": "SA", "region": "Greater Adelaide" },
    "whyalla": { "state": "SA", "region": "Greater Adelaide" },
    "port-augusta": { "state": "SA", "region": "Greater Adelaide" },
    "port-lincoln": { "state": "SA", "region": "Greater Adelaide" },
    "victor-harbor": { "state": "SA", "region": "Greater Adelaide" },
    "norwood": { "state": "SA", "region": "Adelaide Inner" },
    "port-adelaide": { "state": "SA", "region": "Greater Adelaide" },

    // Tasmania
    "hobart": { "state": "TAS", "region": "Greater Hobart" },
    "launceston": { "state": "TAS", "region": "Greater Hobart" },
    "devonport": { "state": "TAS", "region": "Greater Hobart" },
    "burnie": { "state": "TAS", "region": "Greater Hobart" },
    "sandy-bay": { "state": "TAS", "region": "Greater Hobart" },
    "kingston": { "state": "TAS", "region": "Greater Hobart" },

    // Northern Territory
    "darwin": { "state": "NT", "region": "Greater Darwin" },
    "alice-springs": { "state": "NT", "region": "Greater Darwin" },
    "palmerston": { "state": "NT", "region": "Greater Darwin" },
    "katherine": { "state": "NT", "region": "Greater Darwin" },
    "nhulunbuy": { "state": "NT", "region": "Greater Darwin" },

    "campbelltown": { "state": "NSW", "region": "Macarthur" }
  };

  const serviceEntries = await getCollection('services');
  const paths = [];

  for (const service of serviceEntries) {
    for (const [suburbSlug, suburbInfo] of Object.entries(suburbsData)) {
      paths.push({
        params: {
          slug: service.slug,
          suburb: suburbSlug
        },
        props: {
          service,
          suburbInfo: {
            slug: suburbSlug,
            ...suburbInfo
          },
          suburbsData
        },
      });
    }
  }

  return paths;
}

// Get the service and suburb data for the current page
const { service, suburbInfo, suburbsData } = Astro.props;
const { Content } = await service.render();

// Format suburb name for display (convert slug to title case)
const formatSuburbName = (slug: string): string => {
  return slug
    .split('-')
    .map((word: string) => word.charAt(0).toUpperCase() + word.slice(1))
    .join(' ');
};

const suburbName = formatSuburbName(suburbInfo.slug);
const cleanServiceName = getCleanServiceName(service.data.title);

// Get region content if available
const regionData = (regionContent as RegionContentData)[suburbInfo.region] || null;

// Get suburb details if available
const suburbData = (suburbDetails as SuburbDetailsData)[suburbInfo.slug] || null;

// Get nearby suburbs for internal linking
const nearbySuburbs = getNearbySuburbs(suburbInfo.slug, suburbInfo.region, suburbsData as SuburbData, 6);

// Get related services in the same category
const allServices = await getCollection('services');
const relatedServices = allServices
  .filter(s =>
    s.data.category === service.data.category &&
    s.slug !== service.slug
  )
  .slice(0, 3);

// Get related blog posts
const allBlogPosts = await getCollection('blog');
const relatedBlogPosts = getRelatedBlogPosts(service.data.keywords || [], allBlogPosts, 3);

// Create a title and description with the suburb name
const title = service.data.title.replace(/{suburb}/g, suburbName);
const description = service.data.description.replace(/{suburb}/g, suburbName);

// Get quickFacts if available
const quickFacts = service.data.quickFacts;

// Build canonical URL (self-referencing to maintain long-tail rankings)
const canonicalUrl = `https://mdhomecare.com.au/services/${service.slug}/${suburbInfo.slug}`;

// Build breadcrumb data
const breadcrumbs = [
  { name: 'Home', url: 'https://mdhomecare.com.au' },
  { name: 'Services', url: 'https://mdhomecare.com.au/services' },
  { name: cleanServiceName, url: `https://mdhomecare.com.au/services/${service.slug}` },
  { name: suburbName, url: canonicalUrl }
];

// Build Service schema
const serviceSchema = {
  "@type": "Service",
  "@id": `${canonicalUrl}#service`,
  "name": title,
  "description": description,
  "provider": {
    "@type": "LocalBusiness",
    "@id": "https://mdhomecare.com.au/#organization",
    "name": "MD Home Care",
    "telephone": "+61863869999",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "6/11 York St",
      "addressLocality": "Sydney",
      "addressRegion": "NSW",
      "postalCode": "2000",
      "addressCountry": "AU"
    }
  },
  "areaServed": {
    "@type": "City",
    "name": suburbName,
    "containedInPlace": {
      "@type": "State",
      "name": suburbInfo.state === "NSW" ? "New South Wales" :
              suburbInfo.state === "VIC" ? "Victoria" :
              suburbInfo.state === "QLD" ? "Queensland" :
              suburbInfo.state === "WA" ? "Western Australia" :
              suburbInfo.state === "SA" ? "South Australia" :
              suburbInfo.state === "TAS" ? "Tasmania" :
              suburbInfo.state === "NT" ? "Northern Territory" :
              suburbInfo.state === "ACT" ? "Australian Capital Territory" : suburbInfo.state
    }
  },
  "serviceType": service.data.category,
  ...(quickFacts?.costRange && {
    "offers": {
      "@type": "Offer",
      "description": quickFacts.costRange,
      "availability": "https://schema.org/InStock"
    }
  })
};

// Build BreadcrumbList schema
const breadcrumbSchema = {
  "@type": "BreadcrumbList",
  "itemListElement": breadcrumbs.map((item, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "name": item.name,
    ...(index < breadcrumbs.length - 1 ? { "item": item.url } : {})
  }))
};

// Build FAQ schema (service-specific)
const faqSchema = {
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": `What does ${cleanServiceName} cost in ${suburbName}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": quickFacts?.costRange
          ? `${cleanServiceName} in ${suburbName} typically costs ${quickFacts.costRange}. Funding options include ${quickFacts.fundingOptions || 'NDIS, Home Care Packages, and private payment'}. Contact us for a personalized quote.`
          : `The cost of ${cleanServiceName} in ${suburbName} varies based on your individual needs and funding arrangement. We offer services through NDIS, Home Care Packages, DVA, and private payment options. Contact us for a personalized assessment and quote.`
      }
    },
    {
      "@type": "Question",
      "name": `How do I access ${cleanServiceName} in ${suburbName}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": `To access ${cleanServiceName} in ${suburbName}, contact MD Home Care on 08 6386 9999 or through our website. We'll arrange a free consultation to assess your needs, discuss funding options (NDIS, Home Care Packages, or private), and match you with qualified local support workers.`
      }
    },
    {
      "@type": "Question",
      "name": `Do you have local care workers in ${suburbName}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": `Yes, we have qualified care workers based in ${suburbName} and the ${suburbInfo.region} area. All our team members are fully qualified, police-checked, and insured. They understand the local community and can provide consistent, reliable care.`
      }
    },
    {
      "@type": "Question",
      "name": `What funding options are available for ${cleanServiceName} in ${suburbName}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": quickFacts?.fundingOptions
          ? `In ${suburbName}, ${cleanServiceName} can be funded through: ${quickFacts.fundingOptions}. Our team can help you understand your eligibility and navigate the funding process.`
          : `In ${suburbName}, our services can be accessed through NDIS (National Disability Insurance Scheme), Home Care Packages, DVA (Department of Veterans' Affairs), CHSP (Commonwealth Home Support Programme), or private payment. We can help you understand your eligibility for different funding options.`
      }
    },
    {
      "@type": "Question",
      "name": `How quickly can I start ${cleanServiceName} in ${suburbName}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": quickFacts?.waitTime
          ? `For ${cleanServiceName} in ${suburbName}, ${quickFacts.waitTime.toLowerCase()}. For urgent needs, we prioritize rapid response. Contact us to discuss your timeline.`
          : `We aim to begin services as quickly as possible. After your initial consultation, we typically start within 1-2 weeks, though urgent requests can often be accommodated sooner. Contact us to discuss your specific needs.`
      }
    }
  ]
};

// Combine all schemas
const combinedSchema = {
  "@context": "https://schema.org",
  "@graph": [serviceSchema, breadcrumbSchema, faqSchema]
};
---

<script type="application/ld+json" set:html={JSON.stringify(combinedSchema)}></script>

<BaseLayout
  title={title + " | MD Home Care"}
  description={description}
  canonical={canonicalUrl}
>
  <div class="w-full">
    <article>
      <!-- Breadcrumb Navigation -->
      <nav class="max-w-6xl mx-auto px-4 py-3" aria-label="Breadcrumb">
        <ol class="flex flex-wrap items-center gap-2 text-sm">
          {breadcrumbs.map((item, index) => (
            <li class="flex items-center">
              {index > 0 && (
                <svg class="h-4 w-4 mx-2 text-base-content/40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              )}
              {index === breadcrumbs.length - 1 ? (
                <span class="text-base-content/70">{item.name}</span>
              ) : (
                <a href={item.url} class="text-primary hover:underline">{item.name}</a>
              )}
            </li>
          ))}
        </ol>
      </nav>

      <!-- Hero Section -->
      <header
        class="relative min-h-[70vh] bg-cover bg-center bg-fixed flex items-center justify-center"
        style={service.data.image ? `background-image: url(${service.data.image})` : 'background-color: oklch(var(--b2))'}
      >
        <div class="absolute inset-0 bg-gradient-to-b from-black/20 to-black/40"></div>
        <div class="relative z-10 max-w-3xl mx-auto text-center px-4 py-12">
          <div class="card bg-base-100/80 backdrop-blur-lg shadow-2xl border border-base-200">
            <div class="card-body p-8 md:p-12">
              <!-- Location Tags -->
              <div class="flex flex-wrap justify-center gap-2 mb-4">
                <span class="badge badge-primary badge-lg">{service.data.category}</span>
                <span class="badge badge-outline badge-lg">{suburbInfo.region}, {suburbInfo.state}</span>
              </div>

              <!-- Title -->
              <h1 class="text-3xl md:text-5xl font-extrabold text-base-content mb-4 leading-tight">
                {title}
              </h1>

              <!-- Description -->
              <p class="text-lg text-base-content/70 mb-6">
                {description}
              </p>

              <!-- CTA Buttons -->
              <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="tel:+61863869999" class="btn btn-primary btn-lg gap-2 animate-pulse">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                  </svg>
                  <span class="hidden sm:inline">08 6386 9999</span>
                  <span class="sm:hidden">Call Now</span>
                </a>
                <a href="/contact#contact-form" class="btn btn-outline btn-lg">
                  Send Message
                </a>
              </div>

              <!-- Trust Signal -->
              <div class="flex justify-center mt-6">
                <div class="flex flex-col items-center gap-1">
                  <div class="rating rating-md">
                    <input type="radio" class="mask mask-star-2 bg-warning" disabled />
                    <input type="radio" class="mask mask-star-2 bg-warning" disabled />
                    <input type="radio" class="mask mask-star-2 bg-warning" disabled />
                    <input type="radio" class="mask mask-star-2 bg-warning" disabled />
                    <input type="radio" class="mask mask-star-2 bg-warning" disabled checked />
                  </div>
                  <span class="text-sm text-base-content/60">4.8 stars from 45+ verified reviews</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Eligibility Checker Template -->
      <div id="eligibility-checker-template" class="hidden">
        <EligibilityChecker />
      </div>

      <!-- Main Content -->
      <div class="max-w-4xl mx-auto px-4 py-12" id="learn-more">
        <!-- Quick Facts Box -->
        {quickFacts && (
          <QuickFacts
            serviceName={cleanServiceName}
            suburb={suburbName}
            costRange={quickFacts.costRange}
            fundingOptions={quickFacts.fundingOptions}
            availability={quickFacts.availability}
            serviceHours={quickFacts.serviceHours}
            waitTime={quickFacts.waitTime}
          />
        )}

        <!-- Region-Specific Content -->
        {regionData && (
          <div class="bg-base-200 border border-base-300 rounded-box p-6 mb-8">
            <h2 class="text-lg font-bold text-base-content mb-3 flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              About Our {suburbInfo.region} Team
            </h2>
            <p class="text-base-content/80 mb-3">{regionData.localInsight}</p>
            {regionData.transportNote && (
              <p class="text-sm text-base-content/60">
                <strong>Transport:</strong> {regionData.transportNote}
              </p>
            )}
            {suburbData?.nearestHospital && (
              <p class="text-sm text-base-content/60 mt-1">
                <strong>Nearest Hospital:</strong> {suburbData.nearestHospital}
              </p>
            )}
          </div>
        )}

        <div class="prose prose-lg max-w-none" id="content-container" data-suburb={suburbName}>
          <Content />
        </div>

        <!-- CTA Banner -->
        <div class="bg-primary text-primary-content my-12 shadow-lg rounded-box p-6">
          <div class="flex flex-col md:flex-row items-center justify-between w-full gap-4">
            <div>
              <h3 class="font-bold text-xl">Ready to experience our service in {suburbName}?</h3>
              <p class="text-primary-content/90">Contact us today to discuss how we can help you or your loved ones.</p>
            </div>
            <a href="/contact#contact-form" class="btn btn-outline btn-sm md:btn-md border-primary-content text-primary-content hover:bg-primary-content hover:text-primary shrink-0 ml-auto md:ml-0">
              Contact Us
            </a>
          </div>
        </div>
      </div>

      <!-- Nearby Suburbs Section -->
      {nearbySuburbs.length > 0 && (
        <section class="bg-base-100 py-12 px-4 border-t border-base-200">
          <div class="max-w-6xl mx-auto">
            <h2 class="text-2xl font-bold text-base-content mb-6">
              {cleanServiceName} in Nearby {suburbInfo.region} Locations
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
              {nearbySuburbs.map((nearby) => (
                <a
                  href={`/services/${service.slug}/${nearby.slug}`}
                  class="card bg-base-200 hover:bg-base-300 transition-colors border border-base-300"
                >
                  <div class="card-body p-4">
                    <span class="font-medium text-base-content text-sm">{nearby.name}</span>
                  </div>
                </a>
              ))}
            </div>
          </div>
        </section>
      )}

      <!-- Related Services -->
      {relatedServices.length > 0 && (
        <section class="bg-base-200 py-16 px-4">
          <div class="max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold text-center text-base-content mb-10">Related Services in {suburbName}</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              {relatedServices.map((relatedService) => (
                <div class="card bg-base-100 shadow-md hover:shadow-xl transition-all duration-300 hover:-translate-y-1 border border-base-200 hover:border-primary">
                  <div class="card-body">
                    <h3 class="card-title text-lg">{relatedService.data.title.replace(/{suburb}/g, suburbName)}</h3>
                    <p class="text-base-content/70 text-sm line-clamp-3">{relatedService.data.description.replace(/{suburb}/g, suburbName)}</p>
                    <div class="card-actions justify-end mt-4">
                      <a href={`/services/${relatedService.slug}/${suburbInfo.slug}`} class="link link-primary font-semibold inline-flex items-center gap-1">
                        Learn More
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                      </a>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </section>
      )}

      <!-- Related Blog Posts -->
      {relatedBlogPosts.length > 0 && (
        <section class="bg-base-100 py-16 px-4">
          <div class="max-w-6xl mx-auto">
            <h2 class="text-2xl font-bold text-base-content mb-8">Helpful Resources</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              {relatedBlogPosts.map((post) => (
                <a href={`/blog/${post.slug}`} class="card bg-base-200 hover:bg-base-300 transition-colors border border-base-300">
                  <div class="card-body p-5">
                    <h3 class="card-title text-base line-clamp-2">{post.data.title}</h3>
                    <p class="text-sm text-base-content/60 line-clamp-2">{post.data.description}</p>
                  </div>
                </a>
              ))}
            </div>
          </div>
        </section>
      )}

      <!-- Footer Navigation -->
      <footer class="max-w-6xl mx-auto py-8 px-4 border-t border-base-300">
        <div class="flex flex-col sm:flex-row justify-center gap-4">
          <a href="/services" class="btn btn-ghost gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            Back to Services
          </a>
          <a href={`/services/${service.slug}`} class="btn btn-ghost gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            View All Locations
          </a>
        </div>
      </footer>
    </article>
  </div>
</BaseLayout>

<style>
  @reference "../../../../styles/global.css";

  /* iOS fix for background images */
  @supports (-webkit-touch-callout: none) {
    header {
      background-attachment: scroll !important;
    }
  }

  /* Prose styling enhancements */
  .prose h2 {
    @apply text-2xl font-bold mt-10 mb-4 text-base-content border-b border-base-300 pb-2;
  }

  .prose h3 {
    @apply text-xl font-semibold mt-8 mb-3 text-base-content;
  }

  .prose h4 {
    @apply text-lg font-semibold mt-6 mb-2 text-base-content;
  }

  .prose p {
    @apply mb-4 text-base-content;
  }

  .prose ul, .prose ol {
    @apply mb-4 pl-6;
  }

  .prose ul {
    @apply list-disc;
  }

  .prose ol {
    @apply list-decimal;
  }

  .prose li {
    @apply mb-2;
  }

  .prose a {
    @apply link link-primary;
  }

  .prose blockquote {
    @apply border-l-4 border-primary pl-4 py-2 my-6 bg-base-200 rounded-r-lg italic;
  }

  .prose code {
    @apply bg-base-200 px-1.5 py-0.5 rounded text-sm font-mono;
  }

  .prose pre {
    @apply bg-neutral text-neutral-content p-4 rounded-lg overflow-x-auto my-4;
  }

  .prose pre code {
    @apply bg-transparent p-0;
  }

  .prose table {
    @apply w-full border-collapse my-6;
  }

  .prose th, .prose td {
    @apply border border-base-300 px-4 py-2 text-left;
  }

  .prose th {
    @apply bg-base-200 font-semibold;
  }

  .prose :global(img) {
    @apply rounded-2xl shadow-md my-6;
  }

  .prose hr {
    @apply border-base-300 my-8;
  }
</style>

<script define:vars={{ suburbName }}>
document.addEventListener('DOMContentLoaded', () => {
  const contentContainer = document.getElementById('content-container');

  // Function to replace text in an element and its children
  const replaceText = (element, find, replace) => {
    if (element.tagName === 'SCRIPT' || element.tagName === 'STYLE') return;

    if (element.nodeType === Node.TEXT_NODE) {
      const newText = element.textContent.replace(new RegExp(find, 'g'), replace);
      if (element.textContent !== newText) {
        element.textContent = newText;
      }
      return;
    }

    for (const child of element.childNodes) {
      replaceText(child, find, replace);
    }
  };

  // Replace in content container
  if (contentContainer) {
    replaceText(contentContainer, '{suburb}', suburbName);
  }

  // Inject eligibility checker after the second paragraph
  const injectEligibilityChecker = () => {
    const eligibilityTemplate = document.getElementById('eligibility-checker-template');

    if (contentContainer && eligibilityTemplate) {
      const paragraphs = contentContainer.querySelectorAll('p');

      if (paragraphs.length >= 2) {
        const eligibilityChecker = eligibilityTemplate.cloneNode(true);
        eligibilityChecker.id = 'eligibility-checker-injected';
        eligibilityChecker.classList.remove('hidden');
        eligibilityChecker.classList.add('my-8');

        const secondParagraph = paragraphs[1];
        secondParagraph.parentNode.insertBefore(eligibilityChecker, secondParagraph.nextSibling);
      }
    }
  };

  setTimeout(injectEligibilityChecker, 100);
});
</script>
