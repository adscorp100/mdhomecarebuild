---
/**
 * QuickFacts Component
 * Displays key service information in a scannable format for featured snippet optimization
 * and improved CTR through clear cost/availability signals.
 *
 * Uses semantic HTML table structure for better Google featured snippet extraction.
 */

interface Props {
  serviceName: string;
  suburb: string;
  costRange?: string;
  fundingOptions?: string;
  availability?: string;
  serviceHours?: string;
  waitTime?: string;
}

const {
  serviceName,
  suburb,
  costRange,
  fundingOptions,
  availability,
  serviceHours,
  waitTime
} = Astro.props;

// Only render if at least one fact is provided
const hasFacts = costRange || fundingOptions || availability || serviceHours || waitTime;

// Build facts array for table rendering
const factsArray: { label: string; value: string; icon: string }[] = [];
if (costRange) factsArray.push({ label: "Typical Cost", value: costRange, icon: "üí∞" });
if (fundingOptions) factsArray.push({ label: "Funding Options", value: fundingOptions, icon: "üèõÔ∏è" });
if (availability) factsArray.push({ label: "Availability", value: availability, icon: "üìÖ" });
if (serviceHours) factsArray.push({ label: "Service Hours", value: serviceHours, icon: "‚è∞" });
if (waitTime) factsArray.push({ label: "Wait Time to Start", value: waitTime, icon: "üöÄ" });
const facts = factsArray;

// Generate Table schema for better snippet extraction
const tableSchema = hasFacts ? {
  "@context": "https://schema.org",
  "@type": "Table",
  "about": `${serviceName} in ${suburb}`,
  "name": `Quick Facts - ${serviceName} in ${suburb}`
} : null;
---

{hasFacts && (
  <>
    {/* Schema markup for table */}
    {tableSchema && (
      <script type="application/ld+json" set:html={JSON.stringify(tableSchema)}></script>
    )}

    <div class="quick-facts bg-base-200 border border-base-300 rounded-box p-6 mb-8 not-prose" itemscope itemtype="https://schema.org/Service">
      <meta itemprop="name" content={`${serviceName} in ${suburb}`} />

      <h2 class="text-xl font-bold text-base-content mb-4 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Quick Facts ‚Äì {serviceName} in {suburb}
      </h2>

      {/* Semantic table for featured snippet extraction */}
      <table class="w-full quick-facts-table">
        <caption class="sr-only">Key information about {serviceName} in {suburb}</caption>
        <thead class="sr-only">
          <tr>
            <th scope="col">Feature</th>
            <th scope="col">Details</th>
          </tr>
        </thead>
        <tbody>
          {facts.map((fact) => (
            <tr class="border-b border-base-300 last:border-0">
              <th scope="row" class="py-3 pr-4 text-left align-top w-1/3">
                <span class="text-sm font-semibold text-primary uppercase tracking-wide flex items-center gap-2">
                  <span class="text-lg" aria-hidden="true">{fact.icon}</span>
                  {fact.label}
                </span>
              </th>
              <td class="py-3 text-base-content">
                {fact.label === "Typical Cost" && costRange && (
                  <span itemprop="offers" itemscope itemtype="https://schema.org/Offer">
                    <meta itemprop="priceCurrency" content="AUD" />
                    <span itemprop="description">{fact.value}</span>
                  </span>
                )}
                {fact.label === "Funding Options" && (
                  <span>{fact.value}</span>
                )}
                {fact.label === "Availability" && (
                  <span itemprop="hoursAvailable">{fact.value}</span>
                )}
                {fact.label === "Service Hours" && (
                  <span>{fact.value}</span>
                )}
                {fact.label === "Wait Time to Start" && (
                  <span>{fact.value}</span>
                )}
              </td>
            </tr>
          ))}
        </tbody>
      </table>

      {/* Alternative definition list for accessibility */}
      <dl class="hidden">
        {costRange && (
          <>
            <dt>Cost</dt>
            <dd>{costRange}</dd>
          </>
        )}
        {fundingOptions && (
          <>
            <dt>Funding</dt>
            <dd>{fundingOptions}</dd>
          </>
        )}
        {availability && (
          <>
            <dt>Availability</dt>
            <dd>{availability}</dd>
          </>
        )}
        {serviceHours && (
          <>
            <dt>Hours</dt>
            <dd>{serviceHours}</dd>
          </>
        )}
        {waitTime && (
          <>
            <dt>Wait Time</dt>
            <dd>{waitTime}</dd>
          </>
        )}
      </dl>

      {/* CTA row */}
      <div class="mt-4 pt-4 border-t border-base-300 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
        <p class="text-sm text-base-content/70">
          <span class="font-medium">Need help understanding your options?</span>
        </p>
        <a href="/contact" class="btn btn-primary btn-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
          </svg>
          Speak with a Care Advisor
        </a>
      </div>
    </div>

    <style>
      .quick-facts-table th,
      .quick-facts-table td {
        vertical-align: top;
      }

      /* Ensure table renders well on mobile */
      @media (max-width: 640px) {
        .quick-facts-table th,
        .quick-facts-table td {
          display: block;
          width: 100%;
        }

        .quick-facts-table th {
          padding-bottom: 0.25rem;
        }

        .quick-facts-table td {
          padding-top: 0;
          padding-bottom: 1rem;
        }
      }
    </style>
  </>
)}
