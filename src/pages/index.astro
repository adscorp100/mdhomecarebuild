---
import BaseLayout from '../layouts/BaseLayout.astro';
import { Icon } from 'astro-icon/components';
import { getCollection } from 'astro:content';

// Fetch recent blog posts for the resources section
const allBlogPosts = await getCollection('blog');
const recentBlogPosts = allBlogPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

// SEO Metadata
const title = "NDIS Provider Sydney & Melbourne | MD Home Care";
const description = "Trusted NDIS provider in Sydney & Melbourne offering 24/7 home care, SIL accommodation, and support coordination. Empowering independence with compassionate care.";

// Data for sections
const features = [
  {
    icon: "hugeicons:shield-01",
    title: "Vetted Professionals",
    desc: "Every carer is fully background-checked, qualified, and employed directly by us."
  },
  {
    icon: "hugeicons:clock-01",
    title: "24/7 Dedicated Support",
    desc: "Round-the-clock care for complex needs, ensuring peace of mind at all times."
  },
  {
    icon: "hugeicons:favourite",
    title: "Nurse-Led Care",
    desc: "Clinical oversight by Registered Nurses for high-intensity and complex support."
  },
  {
    icon: "hugeicons:global",
    title: "Culturally Diverse",
    desc: "A team that speaks your language and understands your cultural needs."
  }
];

const services = [
  {
    title: "In-Home Support",
    desc: "Personal care, domestic assistance, and daily living support tailored to you.",
    icon: "hugeicons:home-03",
    link: "/services/disability-home-support-services",
    img: "/assets/homecare.webp"
  },
  {
    title: "SIL & Accommodation",
    desc: "Supported Independent Living (SIL) and SDA homes designed for comfort.",
    icon: "hugeicons:building-03",
    link: "/services/sil-services",
    img: "/assets/accessible-bathroom.webp"
  },
  {
    title: "Community Access",
    desc: "Stay connected with social activities, transport, and community participation.",
    icon: "hugeicons:user-group",
    link: "/services/community-access-support",
    img: "/assets/elderlyaboriginal.webp"
  },
  {
    title: "Support Coordination",
    desc: "Expert help to navigate your NDIS plan and maximize your funding.",
    icon: "hugeicons:file-01",
    link: "/services/ndis-specialist-support-coordination",
    img: "/assets/carer.webp"
  }
];

const stats = [
  { label: "Families Supported", value: "500+" },
  { label: "Years Experience", value: "10+" },
  { label: "Suburbs Served", value: "150+" },
  { label: "Satisfaction Rate", value: "98%" },
];
---

<BaseLayout {title} {description}>
  
  <!-- Hero Section -->
  <section
    class="relative min-h-[90vh] flex items-center bg-cover bg-center bg-no-repeat bg-fixed"
    style="background-image: url('/assets/grandmawhite.webp');"
  >
    <!-- Subtle Overlay for Readability -->
    <div class="absolute inset-0 bg-white/50 z-0"></div>

    <div class="container-custom relative z-10 py-20 lg:py-32">
      <div class="flex flex-col lg:flex-row items-center gap-12 lg:gap-20">
        
        <!-- Hero Content -->
        <div class="w-full lg:w-1/2 text-center lg:text-left">
          <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full border border-primary/10 bg-white/40 backdrop-blur-md text-primary text-sm font-semibold mb-8 tracking-wide">
            <span class="relative flex h-2 w-2">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2 w-2 bg-primary"></span>
            </span>
            Taking New Participants
          </div>
          
          <h1 class="text-5xl lg:text-7xl font-bold text-secondary leading-[1.05] mb-6 tracking-tight text-balance">
            Live Independently, <br class="hidden lg:block" />
            <span class="text-primary">Supported by Care.</span>
        </h1>
          
          <p class="text-xl text-secondary/70 font-medium mb-10 leading-relaxed max-w-2xl mx-auto lg:mx-0 text-balance">
            Your trusted NDIS partner in Sydney & Melbourne. We provide compassionate in-home care, SIL accommodation, and specialist support designed around <em>your</em> life.
          </p>
          
          <div class="flex flex-col sm:flex-row items-center gap-4 justify-center lg:justify-start">
            <a href="/contact" class="btn btn-primary btn-lg px-8 rounded-full border-none hover:-translate-y-0.5 transition-transform duration-300">
              Find Support
            </a>
            <a href="/services" class="btn btn-lg px-8 rounded-full bg-white border border-base-200 text-secondary hover:bg-base-200 hover:border-primary/20 transition-all duration-300">
              Explore Services
            </a>
          </div>

          <!-- Trust Badges -->
          <div class="mt-12 flex flex-wrap items-center justify-center lg:justify-start gap-4 text-secondary/70 text-sm font-semibold">
            <div class="flex items-center gap-2 bg-white/40 backdrop-blur-sm px-4 py-1.5 rounded-full border border-white/20">
              <Icon name="hugeicons:tick-02" class="h-4 w-4 text-primary" />
              <span>Verified Quality</span>
            </div>
            <div class="flex items-center gap-2 bg-white/40 backdrop-blur-sm px-4 py-1.5 rounded-full border border-white/20">
              <Icon name="hugeicons:tick-02" class="h-4 w-4 text-primary" />
              <span>No Waitlists</span>
            </div>
            <div class="flex items-center gap-2 bg-white/40 backdrop-blur-sm px-4 py-1.5 rounded-full border border-white/20">
              <Icon name="hugeicons:tick-02" class="h-4 w-4 text-primary" />
              <span>RN Led Teams</span>
            </div>
          </div>
        </div>

        <!-- Floating Call Card (Clickable Button) -->
        <div class="w-full lg:w-1/2 flex justify-center lg:justify-end mt-8 lg:mt-0 relative pointer-events-none">
             <a href="tel:+61863869999" class="pointer-events-auto bg-white/40 backdrop-blur-xl p-5 rounded-[2rem] border border-base-200 flex items-center gap-5 hover:bg-white/60 hover:scale-105 transition-all duration-300 group max-w-xs cursor-pointer shadow-sm">
              <div class="bg-white/80 p-3 rounded-full text-primary group-hover:bg-primary group-hover:text-white transition-colors duration-300">
                <Icon name="hugeicons:call-02" class="h-6 w-6" />
              </div>
              <div>
                <p class="text-xs text-secondary/70 uppercase font-bold tracking-wider mb-1">Need help now?</p>
                <p class="text-xl font-bold text-secondary tracking-tight">08 6386 9999</p>
              </div>
          </a>
        </div>

      </div>
    </div>
  </section>

  <!-- Statistics Strip -->
  <section class="border-y border-base-200 bg-base-200/50">
    <div class="container-custom py-16">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
        {stats.map(stat => (
          <div class="text-center">
            <p class="text-4xl lg:text-5xl font-bold text-primary mb-2 tracking-tighter">{stat.value}</p>
            <p class="text-sm text-secondary/60 font-semibold uppercase tracking-widest">{stat.label}</p>
          </div>
        ))}
      </div>
          </div>
  </section>

  <!-- Services Section -->
  <section class="py-32 bg-base-100">
    <div class="container-custom">
      <div class="text-center max-w-3xl mx-auto mb-20">
        <h2 class="text-sm font-bold text-primary tracking-widest uppercase mb-4">Our Services</h2>
        <h3 class="text-4xl lg:text-5xl font-bold text-secondary mb-6 tracking-tight">Comprehensive Support for Every Stage</h3>
        <p class="text-lg text-secondary/60 leading-relaxed">
          Whether you need daily assistance at home, specialized accommodation, or community access, our team is here to help you achieve your goals.
        </p>
          </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {services.map(service => (
          <a href={service.link} class="group relative flex flex-col h-full bg-base-100 rounded-[2rem] overflow-hidden border border-base-200 hover:border-primary/50 transition-all duration-500 hover:-translate-y-1">
            <div class="h-56 overflow-hidden relative">
              <img src={service.img} alt={service.title} class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-[1.02]" />
              <div class="absolute inset-0 bg-black/5 group-hover:bg-transparent transition-colors duration-500"></div>
            </div>
            <div class="p-8 flex flex-col flex-1 bg-white">
              <div class="w-12 h-12 rounded-full bg-base-100 border border-base-200 flex items-center justify-center text-primary mb-6 -mt-14 relative z-10 group-hover:scale-110 transition-transform duration-300 bg-white">
                <Icon name={service.icon} class="h-6 w-6" />
              </div>
              <h4 class="text-xl font-bold text-secondary mb-3 group-hover:text-primary transition-colors tracking-tight">{service.title}</h4>
              <p class="text-secondary/60 text-sm leading-relaxed mb-6 flex-1">{service.desc}</p>
              <span class="text-primary font-semibold text-sm inline-flex items-center gap-2 mt-auto group-hover:gap-3 transition-all">
                Learn More 
                <Icon name="hugeicons:arrow-right-01" class="h-4 w-4" />
              </span>
          </div>
        </a>
        ))}
      </div>
      
      <div class="text-center mt-16">
        <a href="/services" class="btn btn-outline border-base-200 hover:border-primary hover:bg-transparent hover:text-primary px-8 rounded-full">View All Services</a>
      </div>
    </div>
  </section>

  <!-- Suburb Search Section -->
  <section class="py-32 bg-secondary text-secondary-content relative overflow-hidden">
    <!-- Background Elements -->
    <div class="absolute inset-0 opacity-20 pointer-events-none">
      <div class="absolute right-0 top-0 w-2/3 h-full bg-gradient-to-l from-primary/20 to-transparent"></div>
    </div>

    <div class="container-custom relative z-10">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-4xl lg:text-5xl font-bold mb-8 tracking-tight">Find Support in Your Area</h2>
        <p class="text-lg text-secondary-content/70 mb-12">
          We provide services across Sydney and Melbourne. Enter your suburb to see what's available near you.
        </p>
        
        <div class="relative max-w-xl mx-auto">
          <div class="flex items-center justify-center relative group">
            <div class="absolute left-6 text-base-content/40 z-10">
              <Icon name="hugeicons:search-01" class="h-6 w-6" />
            </div>
            <input
              type="text"
              id="suburb-search"
              placeholder="Search by suburb (e.g. Parramatta, Richmond)..."
              class="input input-lg w-full h-16 pl-14 pr-6 rounded-full bg-base-100 text-base-content focus:outline-none border-2 border-transparent focus:border-primary/50 transition-all duration-300"
            />
          </div>
          <!-- Dropdown Results -->
          <div id="suburb-suggestions" class="hidden absolute left-0 right-0 top-full mt-4 bg-base-100 text-base-content rounded-[1.5rem] shadow-2xl max-h-72 overflow-y-auto z-50 text-left border border-base-200/50 p-2"></div>

          <!-- Service Results Accordion (shown after suburb selection) -->
          <div id="service-results" class="hidden mt-8">
            <div class="bg-base-100 rounded-[1.5rem] border border-base-200/50 overflow-hidden">
              <button id="accordion-toggle" class="w-full flex items-center justify-between p-6 text-left hover:bg-base-200/50 transition-colors">
                <div>
                  <h4 id="accordion-title" class="text-xl font-bold text-secondary">Services in Your Area</h4>
                  <p class="text-sm text-secondary/60 mt-1">Click to view available services</p>
                </div>
                <Icon name="hugeicons:arrow-down-01" id="accordion-icon" class="h-6 w-6 text-primary transition-transform duration-300" />
              </button>
              <div id="accordion-content" class="px-6 pb-6">
                <ul id="service-list" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Why Choose Us -->
  <section class="py-32 bg-base-200/30">
    <div class="container-custom">
      <div class="flex flex-col md:flex-row gap-16 lg:gap-24">
        <div class="md:w-1/3">
          <h2 class="text-sm font-bold text-primary tracking-widest uppercase mb-4">Why MD Homecare?</h2>
          <h3 class="text-4xl lg:text-5xl font-bold text-secondary mb-8 leading-tight tracking-tight">Care That Feels Like Family.</h3>
          <p class="text-secondary/60 mb-10 leading-relaxed text-lg">
            We don't just provide services; we build relationships. Our approach is centered on respect, dignity, and understanding the unique story of every individual we support.
          </p>
          <a href="/about" class="btn btn-primary rounded-full px-8">About Our Team</a>
        </div>

        <div class="md:w-2/3 grid grid-cols-1 sm:grid-cols-2 gap-8">
          {features.map(feature => (
            <div class="card bg-white rounded-[2rem] border border-base-200 hover:border-primary/30 transition-all duration-300 group">
              <div class="card-body p-8">
                <!-- Enhanced Icon Asset -->
                <div class="w-14 h-14 rounded-2xl bg-base-200 flex items-center justify-center text-primary mb-6 group-hover:bg-primary group-hover:text-white transition-all duration-300">
                  <Icon name={feature.icon} class="h-7 w-7" />
              </div>
                <h4 class="text-xl font-bold text-secondary mb-3 tracking-tight">{feature.title}</h4>
                <p class="text-secondary/60 leading-relaxed">{feature.desc}</p>
              </div>
            </div>
          ))}
        </div>
              </div>
            </div>
  </section>

  <!-- Testimonials -->
  <section class="py-32 bg-base-100">
    <div class="container-custom text-center">
      <h2 class="text-4xl lg:text-5xl font-bold text-secondary mb-20 tracking-tight">Stories from Our Community</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- Review 1 -->
        <div class="bg-base-200 rounded-[2rem] p-10 text-left relative group hover:bg-white border border-transparent hover:border-base-200 transition-all duration-500">
          <div class="text-warning text-lg mb-6 flex gap-1">
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
          </div>
          <p class="text-secondary/70 italic mb-8 leading-loose text-lg">
            "The peace of mind I have knowing my mother is being cared for by such genuine, skilled people is priceless. They truly go above and beyond."
          </p>
              <div>
            <p class="font-bold text-secondary">Sarah Jenkins</p>
            <p class="text-xs text-secondary/40 uppercase tracking-wider font-semibold mt-1">Sydney, NSW</p>
          </div>
        </div>

        <!-- Review 2 -->
        <div class="bg-base-200 rounded-[2rem] p-10 text-left relative group hover:bg-white border border-transparent hover:border-base-200 transition-all duration-500">
          <div class="text-warning text-lg mb-6 flex gap-1">
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
              </div>
          <p class="text-secondary/70 italic mb-8 leading-loose text-lg">
            "We struggled to find a provider who understood complex care needs until we found MD Homecare. Their nurses are exceptional."
          </p>
              <div>
            <p class="font-bold text-secondary">Michael Ross</p>
            <p class="text-xs text-secondary/40 uppercase tracking-wider font-semibold mt-1">Melbourne, VIC</p>
          </div>
        </div>

        <!-- Review 3 -->
        <div class="bg-base-200 rounded-[2rem] p-10 text-left relative group hover:bg-white border border-transparent hover:border-base-200 transition-all duration-500">
          <div class="text-warning text-lg mb-6 flex gap-1">
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
            <Icon name="hugeicons:star" class="h-5 w-5 fill-current" />
              </div>
          <p class="text-secondary/70 italic mb-8 leading-loose text-lg">
            "Consistent, reliable, and friendly. The support workers actually engage with my son and have helped him build confidence."
          </p>
              <div>
            <p class="font-bold text-secondary">Amanda Lee</p>
            <p class="text-xs text-secondary/40 uppercase tracking-wider font-semibold mt-1">Parramatta, NSW</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-32 bg-primary text-primary-content relative overflow-hidden">
    <!-- Decorative circles -->
    <div class="absolute top-0 right-0 -translate-y-1/2 translate-x-1/3 w-[500px] h-[500px] bg-white/5 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 left-0 translate-y-1/2 -translate-x-1/3 w-[500px] h-[500px] bg-white/5 rounded-full blur-3xl"></div>

    <div class="container-custom relative z-10 text-center">
      <h2 class="text-4xl lg:text-6xl font-bold mb-8 tracking-tight">Ready to Start Your Journey?</h2>
      <p class="text-xl text-primary-content/80 mb-12 max-w-2xl mx-auto leading-relaxed">
        Speak to our friendly team today about your NDIS plan or home care needs. We're here to listen and help.
      </p>
      <div class="flex flex-col sm:flex-row gap-6 justify-center">
        <a href="/contact" class="btn btn-lg bg-white text-primary hover:bg-base-100 border-none shadow-none rounded-full px-10">
          Contact Us Today
        </a>
        <a href="tel:+61863869999" class="btn btn-lg btn-outline text-white border-white/30 hover:bg-white/10 hover:border-white rounded-full px-10">
          <Icon name="hugeicons:call-02" class="h-5 w-5" />
          Call 08 6386 9999
        </a>
      </div>
    </div>
  </section>

  <!-- Resources/Blog Section -->
  <section class="py-32 bg-base-100">
    <div class="container-custom">
      <div class="flex flex-col sm:flex-row justify-between items-end mb-16 gap-4">
        <div>
          <h2 class="text-sm font-bold text-primary tracking-widest uppercase mb-4">Resources</h2>
          <h3 class="text-4xl font-bold text-secondary tracking-tight">Latest News & Guides</h3>
        </div>
        <a href="/blog" class="link link-hover text-primary font-semibold flex items-center gap-2 hover:gap-3 transition-all">
          View all articles
          <Icon name="hugeicons:arrow-right-01" class="h-4 w-4" />
        </a>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        {recentBlogPosts.map(post => (
          <a href={`/blog/${post.slug}`} class="group">
            <div class="rounded-[2rem] overflow-hidden mb-6 aspect-[16/10] relative bg-base-200">
              <img 
                src={post.data.image || '/assets/homecare.webp'} 
                alt={post.data.title} 
                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" 
              />
              <div class="absolute inset-0 ring-1 ring-inset ring-black/5 rounded-[2rem]"></div>
            </div>
            <h4 class="text-xl font-bold text-secondary mb-3 group-hover:text-primary transition-colors line-clamp-2 tracking-tight">
              {post.data.title}
            </h4>
            <p class="text-secondary/50 text-xs mb-3 font-medium uppercase tracking-wider">
              {new Date(post.data.pubDate).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
            </p>
            <p class="text-secondary/60 line-clamp-2 text-sm leading-relaxed">
              {post.data.description}
            </p>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Service Modal (Kept for functionality) -->
  <dialog id="service-modal" class="modal">
    <div class="modal-box max-w-3xl rounded-2xl p-0 overflow-hidden">
      <div class="bg-secondary p-6 flex justify-between items-center text-white">
        <h3 class="font-bold text-xl" id="modal-title">Available Services</h3>
      <form method="dialog">
          <button class="btn btn-sm btn-circle btn-ghost text-white/70 hover:text-white">
          <Icon name="hugeicons:cancel-01" class="h-5 w-5" />
        </button>
      </form>
      </div>
      <div class="p-6 max-h-[70vh] overflow-y-auto">
      <ul id="modal-service-list" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></ul>
      </div>
    </div>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>

</BaseLayout>

<script>
  // Suburb Search Functionality
  const services = [
    { name: "Accommodation Support", slug: "accommodation-support" },
    { name: "Aged Care Advocacy", slug: "aged-care-advocacy" },
    { name: "Home Modifications", slug: "aged-care-home-modifications-maintenance" },
    { name: "Allied Health", slug: "allied-health-disciplines" },
    { name: "Assistive Technology", slug: "assistive-technology-assessment" },
    { name: "Behaviour Support", slug: "behaviour-support" },
    { name: "Clinical Care", slug: "clinical-care" },
    { name: "Community Access", slug: "community-access-support" },
    { name: "Community Nursing", slug: "community-nursing-care" },
    { name: "Companionship Services", slug: "companionship-services" },
    { name: "Complex Care", slug: "complex-care" },
    { name: "Continence Care", slug: "continence-care-home" },
    { name: "Domestic Assistance", slug: "domestic-assistance" },
    { name: "Home Care Packages", slug: "home-care-packages" },
    { name: "Life Skills Development", slug: "life-skills-development" },
    { name: "Meal Preparation", slug: "meal-preparation-support" },
    { name: "Occupational Therapy", slug: "occupational-therapy-home" },
    { name: "Personal Care", slug: "personal-care" },
    { name: "Physiotherapy", slug: "physiotherapy-home-care" },
    { name: "Plan Management", slug: "plan-management" },
    { name: "Psychosocial Recovery Coaching", slug: "psychosocial-recovery-coaching" },
    { name: "Respite Care", slug: "respite-care" },
    { name: "SIL Services", slug: "sil-services" },
    { name: "Specialist Coordination", slug: "ndis-specialist-support-coordination" },
    { name: "Specialist Disability Accommodation", slug: "specialist-disability-accommodation" },
    { name: "Support Workers", slug: "support-workers" },
    { name: "Transport Services", slug: "transport-services" }
  ];

  const searchInput = document.getElementById('suburb-search') as HTMLInputElement;
  const suggestionsPanel = document.getElementById('suburb-suggestions') as HTMLDivElement;
  const modal = document.getElementById('service-modal') as HTMLDialogElement;
  const modalTitle = document.getElementById('modal-title') as HTMLHeadingElement;
  const modalServiceList = document.getElementById('modal-service-list') as HTMLUListElement;

  let suburbs: { [key: string]: { state: string; region: string } } = {};

  async function fetchSuburbs() {
    try {
      const response = await fetch('/data/australian-suburbs.json');
      if (!response.ok) throw new Error('Network response was not ok');
      suburbs = await response.json();
    } catch (error) {
      console.error('Failed to fetch suburbs:', error);
    }
  }

  function displaySuggestions(input: string) {
    const suburbKeys = Object.keys(suburbs);
    const filteredSuburbs = suburbKeys.filter(suburb => suburb.toLowerCase().startsWith(input)).slice(0, 10);
    suggestionsPanel.innerHTML = '';

    if (filteredSuburbs.length > 0) {
      filteredSuburbs.forEach(suburb => {
        const div = document.createElement('div');
        const state = suburbs[suburb].state;
        const displayName = toTitleCase(suburb.replace(/-/g, ' '));
        
        div.innerHTML = `
          <div class="px-4 py-3 cursor-pointer hover:bg-base-200 transition-colors border-b border-base-200 last:border-none">
            <p class="font-medium text-secondary">${displayName}</p>
            <p class="text-xs text-base-content/50 uppercase">${state}</p>
          </div>
        `;
        
        div.onclick = () => {
          showServicesForSuburb(suburb);
        };
        suggestionsPanel.appendChild(div);
      });
      suggestionsPanel.classList.remove('hidden');
    } else {
      suggestionsPanel.classList.add('hidden');
    }
  }

  function toTitleCase(str: string) {
    return str.replace(/\w\S*/g, (txt: string) => txt.charAt(0).toUpperCase() + txt.slice(1).toLowerCase());
  }

  function showServicesForSuburb(suburbKey: string) {
    const displayName = toTitleCase(suburbKey.replace(/-/g, ' '));
    modalTitle.textContent = `Services in ${displayName}`;
    modalServiceList.innerHTML = '';

    services.forEach(service => {
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = `/services/${service.slug}/${suburbKey}`;
      a.textContent = service.name;
      a.className = 'block p-3 bg-base-100 border border-base-200 rounded-lg hover:border-primary hover:text-primary hover:shadow-sm font-medium transition-all text-sm text-center sm:text-left';
      li.appendChild(a);
      modalServiceList.appendChild(li);
    });

    modal.showModal();
    suggestionsPanel.classList.add('hidden');
    searchInput.value = '';
  }

  if (searchInput) {
  searchInput.addEventListener('input', () => {
    const input = searchInput.value.toLowerCase();
    if (input.length > 1) {
      displaySuggestions(input);
    } else {
      suggestionsPanel.classList.add('hidden');
    }
  });

  document.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
      if (suggestionsPanel && !suggestionsPanel.contains(target) && target !== searchInput) {
      suggestionsPanel.classList.add('hidden');
    }
  });
  }

  fetchSuburbs();
</script>
