---
import { getCollection } from 'astro:content';
import type { GetStaticPathsOptions } from 'astro';
import BlogPage from './_BlogPage.astro';

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  // Get all blog posts
  const allPosts = await getCollection('blog');

  // Sort posts by last update date (fallback to pubDate)
  const sortedPosts = allPosts.sort(
    (a, b) => {
      const aDate = (a.data.updateDate || a.data.pubDate).valueOf();
      const bDate = (b.data.updateDate || b.data.pubDate).valueOf();
      return bDate - aDate;
    }
  );

  // Generate pages with 20 posts per page, but exclude page 1 as it will be at /blog
  return paginate(sortedPosts, { pageSize: 20 }).filter(page => page.params.page !== '1');
}

const { page } = Astro.props;
---

<BlogPage page={page} /> 